00:00 [32m+0[0m: [1m[90mloading test/lint/linter_ok_test.dart[0m[0m                                                                                                                                                        00:00 [32m+0[0m: test/lint/linter_ok_test.dart: Valid shape: head/guards only pre-commit; single SuspendEnd after clauses[0m                                                                                     00:00 [32m+1[0m: test/lint/linter_ok_test.dart: Valid shape: head/guards only pre-commit; single SuspendEnd after clauses[0m                                                                                     00:00 [32m+2[0m: test/lint/linter_body_precommit_test.dart: Body op before commit is flagged[0m                                                                                                                  00:00 [32m+3[0m: test/lint/linter_body_precommit_test.dart: Body op before commit is flagged[0m                                                                                                                  00:00 [32m+3[0m: [1m[90mloading test/smoke_test.dart[0m[0m                                                                                                                                                                 00:00 [32m+3[0m: test/smoke_test.dart: project skeleton exists[0m                                                                                                                                                00:00 [32m+4[0m: test/smoke_test.dart: project skeleton exists[0m                                                                                                                                                00:00 [32m+4[0m: [1m[90mloading test/srsw_test.dart[0m[0m                                                                                                                                                                  00:00 [32m+4[0m: test/srsw_test.dart: SRSW violation: repeated variable should be rejected[0m                                                                                                                    00:00 [32m+4[0m: test/srsw_test.dart: SRSW violation: repeated variable should be rejected[0m                                                                                                                    

Testing SRSW violation: same(f(X, X))
âœ… Correctly rejected repeated variable
00:00 [32m+5[0m: test/glp_runtime_test.dart: calculate[0m                                                                                                                                                        00:00 [32m+6[0m: test/bytecode/union_end_to_end_test.dart: Union across two SUSPEND_READY clauses then single suspend at end[0m                                                                                  00:00 [32m+6[0m: test/bytecode/known_instruction_test.dart: Known instruction: succeeds for bound constant[0m                                                                                                    

=== KNOWN INSTRUCTION TEST: Bound Constant ===
Starting p(X) where X = a (known)
00:00 [32m+7[0m: test/bytecode/known_instruction_test.dart: Known instruction: succeeds for bound constant[0m                                                                                                    00:00 [32m+7[0m[31m -1[0m: test/bytecode/known_instruction_test.dart: Known instruction: succeeds for bound constant[0m                                                                                                 
Goals executed: 1
âœ“ Known instruction succeeded for bound constant

00:00 [32m+8[0m[31m -1[0m: test/bytecode/known_instruction_test.dart: Known instruction: succeeds for bound constant[0m                                                                                                 00:00 [32m+8[0m[31m -1[0m: test/bytecode/known_instruction_test.dart: Known instruction: fails for unbound writer[0m                                                                                                    00:00 [32m+8[0m[31m -1[0m: test/bytecode/known_instruction_test.dart: Known instruction: fails for unbound writer[0m                                                                                                    

=== KNOWN INSTRUCTION TEST: Unbound Writer ===
Starting p(X) where X is unbound (not known)
Goals executed: 1
âœ“ Known instruction failed for unbound writer, otherwise clause executed

00:00 [32m+9[0m[31m -1[0m: test/bytecode/known_instruction_test.dart: Known instruction: fails for unbound writer[0m                                                                                                    00:00 [32m+9[0m[31m -1[0m: test/bytecode/known_instruction_test.dart: Known instruction: succeeds for bound structure with unbound variable[0m                                                                          00:00 [32m+9[0m[31m -1[0m: test/bytecode/known_instruction_test.dart: Known instruction: succeeds for bound structure with unbound variable[0m                                                                          

=== KNOWN INSTRUCTION TEST: Known Structure (even with unbound internals) ===
Starting p(X) where X = f(Y) with Y unbound
X is known (bound to structure) even though Y inside is unbound
Goals executed: 1
âœ“ Known instruction succeeded - X is known even with unbound internals

00:00 [32m+10[0m[31m -1[0m: test/bytecode/known_instruction_test.dart: Known instruction: succeeds for bound structure with unbound variable[0m                                                                         00:00 [32m+10[0m[31m -1[0m: test/bytecode/union_end_to_end_test.dart: Commit applies ÏƒÌ‚w: wake suspended readers for those writers [1m[31m[E][0m[0m                                                                               
  Expected: [3000, 4000]
    Actual: []
     Which: at location [0] is [] which shorter than expected
  
  package:matcher                                expect
  test/bytecode/union_end_to_end_test.dart 73:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/bytecode/union_end_to_end_test.dart -p vm --plain-name 'Commit applies ÏƒÌ‚w: wake suspended readers for those writers'
00:00 [32m+10[0m[31m -1[0m: [1m[90mloading test/bytecode/env_frame_test.dart[0m[0m                                                                                                                                                00:00 [32m+10[0m[31m -1[0m: test/bytecode/env_frame_test.dart: Allocate creates environment frame with permanent variables[0m                                                                                           00:00 [32m+10[0m[31m -1[0m: test/bytecode/env_frame_test.dart: Allocate creates environment frame with permanent variables[0m                                                                                           

=== ALLOCATE TEST: Environment frame creation ===
Starting p('a') - should allocate frame and succeed...
Goals executed: 1
âœ“ Allocate instruction executed successfully

00:00 [32m+11[0m[31m -1[0m: test/bytecode/commit_before_body_heap_test.dart: Pre-commit: body ops ignored; no heap mutation[0m                                                                                          00:00 [32m+11[0m[31m -1[0m: test/bytecode/env_frame_test.dart: Deallocate removes environment frame[0m                                                                                                                  

=== DEALLOCATE TEST: Environment frame removal ===
Starting p('b') - should allocate, deallocate, and succeed...
00:00 [32m+11[0m[31m -1[0m: test/bytecode/commit_before_body_heap_test.dart: Pre-commit: body ops ignored; no heap mutation[0m                                                                                          00:00 [32m+11[0m[31m -1[0m: test/bytecode/env_frame_test.dart: Deallocate removes environment frame[0m                                                                                                                  
Goals executed: 1
âœ“ Deallocate instruction executed successfully

00:00 [32m+12[0m[31m -1[0m: test/bytecode/commit_before_body_heap_test.dart: Pre-commit: body ops ignored; no heap mutation[0m                                                                                          00:00 [32m+12[0m[31m -1[0m: test/bytecode/env_frame_test.dart: Nested environment frames (allocate within allocate)[0m                                                                                                  

=== NESTED FRAMES TEST: Multiple allocations ===
Starting p('c') - should handle nested frames correctly...
Goals executed: 1
âœ“ Nested environment frames handled correctly

00:00 [32m+13[0m[31m -1[0m: test/bytecode/commit_before_body_heap_test.dart: Pre-commit: body ops ignored; no heap mutation[0m                                                                                          00:00 [32m+14[0m[31m -1[0m: test/bytecode/scheduler_suspend_wake_test.dart: Scheduler drains FIFO activations after a single reader bind[0m                                                                             00:00 [32m+15[0m[31m -1[0m: test/bytecode/scheduler_suspend_wake_test.dart: Scheduler drains FIFO activations after a single reader bind[0m                                                                             00:00 [32m+16[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: succeeds for ground constant[0m                                                                                             00:00 [32m+16[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: succeeds for ground constant[0m                                                                                             

=== GROUND INSTRUCTION TEST: Ground Constant ===
Starting p(X) where X = a (ground constant)
Goals executed: 1
âœ“ Ground instruction succeeded for ground constant

00:00 [32m+17[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: succeeds for ground constant[0m                                                                                             00:00 [32m+17[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: fails for unbound writer[0m                                                                                                 00:00 [32m+17[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: fails for unbound writer[0m                                                                                                 

=== GROUND INSTRUCTION TEST: Unbound Writer ===
Starting p(X) where X is unbound (not ground)
Goals executed: 1
âœ“ Ground instruction failed for unbound writer, otherwise clause executed

00:00 [32m+18[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: fails for unbound writer[0m                                                                                                 00:00 [32m+18[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: succeeds for ground structure[0m                                                                                            00:00 [32m+18[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: succeeds for ground structure[0m                                                                                            

=== GROUND INSTRUCTION TEST: Ground Structure ===
Starting p(X) where X = f(a, b) (ground structure)
Goals executed: 1
âœ“ Ground instruction succeeded for ground structure

00:00 [32m+19[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: succeeds for ground structure[0m                                                                                            00:00 [32m+19[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: fails for structure with unbound variable[0m                                                                                00:00 [32m+19[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: fails for structure with unbound variable[0m                                                                                

=== GROUND INSTRUCTION TEST: Non-Ground Structure ===
Starting p(X) where X = f(Y) with Y unbound (not ground)
Goals executed: 1
âœ“ Ground instruction failed for non-ground structure

00:00 [32m+20[0m[31m -1[0m: test/bytecode/ground_instruction_test.dart: Ground instruction: fails for structure with unbound variable[0m                                                                                00:00 [32m+20[0m[31m -1[0m: [1m[90mloading test/bytecode/fairness_scheduler_loop_test.dart[0m[0m                                                                                                                                  00:00 [32m+20[0m[31m -1[0m: test/bytecode/fairness_scheduler_loop_test.dart: Two goals alternate due to 26-step tail yield[0m                                                                                           00:00 [32m+20[0m[31m -1[0m: test/bytecode/utility_instructions_test.dart: Nop: no operation, just advances PC[0m                                                                                                        

=== NOP TEST: No operation ===
00:00 [32m+21[0m[31m -1[0m: test/bytecode/utility_instructions_test.dart: Nop: no operation, just advances PC[0m                                                                                                        00:00 [32m+21[0m[31m -1[0m: test/bytecode/utility_instructions_test.dart: Nop: no operation, just advances PC[0m                                                                                                        
Starting p with 3 nops
Goals executed: 1
âœ“ Nop instruction works correctly

00:00 [32m+22[0m[31m -1[0m: test/bytecode/asm_smoke_test.dart: Assembler: union across clauses then suspend; wake FIFO once[0m                                                                                          00:00 [32m+22[0m[31m -1[0m: test/bytecode/utility_instructions_test.dart: Halt: terminates execution[0m                                                                                                                 

=== HALT TEST: Terminate execution ===
Starting p with halt
Goals executed: 1
âœ“ Halt instruction terminates correctly

00:00 [32m+23[0m[31m -1[0m: test/bytecode/asm_smoke_test.dart: Assembler: union across clauses then suspend; wake FIFO once[0m                                                                                          00:00 [32m+23[0m[31m -1[0m: test/bytecode/utility_instructions_test.dart: Halt vs Proceed: both terminate[0m                                                                                                            

=== HALT VS PROCEED TEST ===
Testing halt...
âœ“ Halt terminated after 1 execution
Testing proceed...
âœ“ Proceed terminated after 1 execution
âœ“ Both Halt and Proceed terminate execution

00:00 [32m+24[0m[31m -1[0m: test/bytecode/asm_smoke_test.dart: Assembler: union across clauses then suspend; wake FIFO once[0m                                                                                          00:00 [32m+25[0m[31m -1[0m: test/bytecode/asm_smoke_test.dart: Assembler: union across clauses then suspend; wake FIFO once[0m                                                                                          00:00 [32m+25[0m[31m -1[0m: test/bytecode/asm_smoke_test.dart: Assembler: commit wakes readers bound to writers in ÏƒÌ‚w[0m                                                                                               00:00 [32m+25[0m[31m -2[0m: test/bytecode/spec_control_flow_test.dart: ClauseNext: moves to next clause and accumulates Si into U[0m                                                                                    

=== CLAUSENEXT TEST: Spec-compliant clause control flow ===
Starting p(X?) with unbound reader...
Goals executed: 1
00:00 [32m+25[0m[31m -2[0m: test/bytecode/asm_smoke_test.dart: Assembler: commit wakes readers bound to writers in ÏƒÌ‚w [1m[31m[E][0m[0m                                                                                           
  Expected: [9001, 9002]
    Actual: []
     Which: at location [0] is [] which shorter than expected
  
  package:matcher                         expect
  test/bytecode/asm_smoke_test.dart 70:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/bytecode/asm_smoke_test.dart -p vm --plain-name 'Assembler: commit wakes readers bound to writers in ÏƒÌ‚w'
00:00 [32m+25[0m[31m -2[0m: test/bytecode/spec_control_flow_test.dart: ClauseNext: moves to next clause and accumulates Si into U[0m                                                                                    
âœ“ ClauseNext correctly transitioned to next clause

00:00 [32m+26[0m[31m -2[0m: test/bytecode/spec_control_flow_test.dart: ClauseNext: moves to next clause and accumulates Si into U[0m                                                                                    00:00 [32m+26[0m[31m -2[0m: test/bytecode/spec_control_flow_test.dart: NoMoreClauses: suspends when U non-empty[0m                                                                                                      00:00 [32m+26[0m[31m -2[0m: test/bytecode/spec_control_flow_test.dart: NoMoreClauses: suspends when U non-empty[0m                                                                                                      

=== NOMORECLAUSES TEST: Suspension on U ===
Starting p(X?) with unbound reader - should suspend...
Goals executed: 1
ROQ has suspension notes: true
âœ“ NoMoreClauses correctly suspended goal on U

00:00 [32m+27[0m[31m -2[0m: test/bytecode/spec_control_flow_test.dart: NoMoreClauses: suspends when U non-empty[0m                                                                                                      00:00 [32m+27[0m[31m -2[0m: test/bytecode/spec_control_flow_test.dart: NoMoreClauses: fails when U empty[0m                                                                                                             00:00 [32m+27[0m[31m -2[0m: test/bytecode/spec_control_flow_test.dart: NoMoreClauses: fails when U empty[0m                                                                                                             

=== NOMORECLAUSES TEST: Failure when U empty ===
Starting p('b') when program expects 'a' - should fail...
Goals executed: 1
âœ“ NoMoreClauses correctly failed when U empty

00:00 [32m+28[0m[31m -2[0m: test/bytecode/list_instructions_test.dart: HeadNil: matches empty list [][0m                                                                                                                00:00 [32m+28[0m[31m -2[0m: test/bytecode/spec_control_flow_test.dart: Spec-compliant control flow: full clause selection example[0m                                                                                    

=== SPEC CONTROL FLOW: Full example with new instructions ===
Test 1: p('a', Y?) where Y unbound...
  Result: 1 executions
  âœ“ Clause 1 failed (ground), otherwise succeeded
Test 2: p('c', Y?) where X doesn't match any clause...
  Result: 1 executions
  âœ“ All clauses failed head match, otherwise succeeded
âœ“ Spec-compliant control flow working correctly

00:00 [32m+29[0m[31m -2[0m: test/bytecode/list_instructions_test.dart: HeadNil: matches empty list [][0m                                                                                                                00:00 [32m+29[0m[31m -2[0m: test/bytecode/list_instructions_test.dart: HeadNil: matches empty list [][0m                                                                                                                

=== HEADNIL TEST: Match [] ===
Starting p([])
Goals executed: 1
âœ“ HeadNil matched empty list

00:00 [32m+29[0m[31m -3[0m: [1m[90mloading test/refactoring/heap_v2_integration_test.dart[0m [1m[31m[E][0m[0m                                                                                                                               
  [31mFailed to load "test/refactoring/heap_v2_integration_test.dart":[0m
  test/refactoring/heap_v2_integration_test.dart:13:8: Error: Error when reading 'lib/runtime/heap_v2_adapter.dart': No such file or directory
  import 'package:glp_runtime/runtime/heap_v2_adapter.dart';
         ^
  test/refactoring/heap_v2_integration_test.dart:115:24: Error: Method not found: 'HeapV2Adapter'.
      ? GlpRuntime(heap: HeapV2Adapter())
                         ^^^^^^^^^^^^^
  test/refactoring/heap_v2_integration_test.dart:184:24: Error: Method not found: 'HeapV2Adapter'.
      ? GlpRuntime(heap: HeapV2Adapter())
                         ^^^^^^^^^^^^^
  test/refactoring/heap_v2_integration_test.dart:263:24: Error: Method not found: 'HeapV2Adapter'.
      ? GlpRuntime(heap: HeapV2Adapter())
                         ^^^^^^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/refactoring/heap_v2_integration_test.dart -p vm --plain-name 'loading test/refactoring/heap_v2_integration_test.dart'
00:00 [32m+30[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 1: Verify migration preserves program structure[0m                                00:00 [32m+30[0m[31m -3[0m: test/bytecode/list_instructions_test.dart: HeadNil: fails for non-empty list[0m                                                                                                             

=== HEADNIL TEST: Fail on [a] ===
Starting p([a]) - should fail HeadNil and use otherwise
Goals executed: 1
âœ“ HeadNil correctly failed for non-empty list

00:00 [32m+31[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 1: Verify migration preserves program structure[0m                                00:00 [32m+31[0m[31m -3[0m: test/bytecode/list_instructions_test.dart: HeadList: matches list [a|Xs] and extracts head/tail[0m                                                                                          

=== HEADLIST TEST: Match [a|Xs] ===
00:00 [32m+31[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 1: Verify migration preserves program structure[0m                                

=== TEST 1: Migration Preserves Program Structure ===

00:00 [32m+31[0m[31m -3[0m: test/bytecode/list_instructions_test.dart: HeadList: matches list [a|Xs] and extracts head/tail[0m                                                                                          
Starting p([a, b])
00:00 [32m+31[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 1: Verify migration preserves program structure[0m                                
Original program: 13 instructions
00:00 [32m+31[0m[31m -3[0m: test/bytecode/list_instructions_test.dart: HeadList: matches list [a|Xs] and extracts head/tail[0m                                                                                          
Goals executed: 1
âœ“ HeadList matched list structure

00:00 [32m+32[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 1: Verify migration preserves program structure[0m                                00:00 [32m+32[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 1: Verify migration preserves program structure[0m                                
Migration Statistics:
  Total instructions: 13
  Migrated to v2: 4
  Kept as v1: 9
  Migration rate: 30.8%
  Instruction breakdown:
    Label: 2
    ClauseTry: 1
    head_writer: 1
    head_reader: 1
    HeadConstant: 1
    Commit: 1
    put_writer: 1
    put_reader: 1
    PutConstant: 1
    Spawn: 1
    Proceed: 1
    SuspendEnd: 1

âœ“ Program structure preserved
  4/13 instructions migrated

00:00 [32m+32[0m[31m -3[0m: test/bytecode/list_instructions_test.dart: PutNil and PutList: instructions exist and execute without error[0m                                                                              

=== PUTNIL/PUTLIST TEST: Basic execution ===
Starting p() - simple program to verify test framework works
Goals executed: 1
âœ“ PutNil and PutList instructions exist (tested in integration)

00:00 [32m+33[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 1: Verify migration preserves program structure[0m                                00:00 [32m+34[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 1: Verify migration preserves program structure[0m                                00:00 [32m+34[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 2: Verify all paired instructions migrate correctly[0m                            00:00 [32m+34[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 2: Verify all paired instructions migrate correctly[0m                            

=== TEST 2: All Paired Instructions Migrate ===

âœ“ HeadWriter -> HeadVariable
âœ“ HeadReader -> HeadVariable
âœ“ PutWriter -> PutVariable
âœ“ PutReader -> PutVariable
âœ“ SetWriter -> SetVariable
âœ“ SetReader -> SetVariable
âœ“ UnifyWriter -> UnifyVariable
âœ“ UnifyReader -> UnifyVariable
âœ“ IfWriter -> IfVariable
âœ“ IfReader -> IfVariable

âœ“ All 10 paired instruction types migrate correctly

00:00 [32m+35[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 2: Verify all paired instructions migrate correctly[0m                            00:00 [32m+35[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 3: Verify non-paired instructions not migrated[0m                                 00:00 [32m+35[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 3: Verify non-paired instructions not migrated[0m                                 

=== TEST 3: Non-Paired Instructions Preserved ===

âœ“ Label preserved as v1
âœ“ ClauseTry preserved as v1
âœ“ Commit preserved as v1
âœ“ Proceed preserved as v1
âœ“ SuspendEnd preserved as v1
âœ“ HeadConstant preserved as v1
âœ“ PutConstant preserved as v1
âœ“ GetVariable preserved as v1
âœ“ Spawn preserved as v1

âœ“ All 9 non-paired instructions preserved

00:00 [32m+36[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 3: Verify non-paired instructions not migrated[0m                                 00:00 [32m+36[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 4: Verify round-trip equivalence[0m                                               00:00 [32m+36[0m[31m -3[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 4: Verify round-trip equivalence[0m                                               

=== TEST 4: Round-Trip Equivalence ===

00:00 [32m+36[0m[31m -4[0m: [1m[90mloading test/refactoring/heap_compatibility_test.dart[0m [1m[31m[E][0m[0m                                                                                                                                
  [31mFailed to load "test/refactoring/heap_compatibility_test.dart":[0m
  test/refactoring/heap_compatibility_test.dart:3:8: Error: Error when reading 'lib/runtime/heap_v2.dart': No such file or directory
  import 'package:glp_runtime/runtime/heap_v2.dart';
         ^
  test/refactoring/heap_compatibility_test.dart:17:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:38:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:62:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:89:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:102:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:124:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:143:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:161:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:185:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:204:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^
  test/refactoring/heap_compatibility_test.dart:231:21: Error: Method not found: 'HeapV2'.
        final heap2 = HeapV2();
                      ^^^^^^

[1m[36mTo run this test again:[0m dart test test/refactoring/heap_compatibility_test.dart -p vm --plain-name 'loading test/refactoring/heap_compatibility_test.dart'
00:00 [32m+36[0m[31m -4[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 4: Verify round-trip equivalence[0m                                               
âœ“ Round-trip migration preserves equivalence
  Original: 11 v1 instructions
  Migrated: 4 v2, 7 v1

00:00 [32m+37[0m[31m -4[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 4: Verify round-trip equivalence[0m                                               00:00 [32m+37[0m[31m -4[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 5: Verify migration statistics accuracy[0m                                        00:00 [32m+37[0m[31m -4[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 5: Verify migration statistics accuracy[0m                                        

=== TEST 5: Migration Statistics Accuracy ===

Migration Statistics:
  Total: 10
  Migrated: 3
  Preserved: 7
  Rate: 30.0%

âœ“ Statistics accurate

00:00 [32m+38[0m[31m -4[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 5: Verify migration statistics accuracy[0m                                        00:00 [32m+38[0m[31m -4[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 6: Verify isReader flag correctness[0m                                            00:00 [32m+38[0m[31m -4[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 6: Verify isReader flag correctness[0m                                            

=== TEST 6: IsReader Flag Correctness ===

âœ“ All writer instructions have isReader=false
âœ“ All reader instructions have isReader=true

00:00 [32m+39[0m[31m -4[0m: test/refactoring/instruction_integration_v2_test.dart: Phase 2.5: Instruction Integration Validation Test 6: Verify isReader flag correctness[0m                                            00:00 [32m+39[0m[31m -4[0m: [1m[90mloading test/refactoring/instruction_migration_test.dart[0m[0m                                                                                                                                 00:00 [32m+39[0m[31m -4[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 1: Individual instruction migration[0m                                                          00:00 [32m+39[0m[31m -4[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 1: Individual instruction migration[0m                                                          

=== TEST 1: Individual Instruction Migration ===

âœ“ HeadWriter(5) -> head_writer(5)
âœ“ HeadReader(7) -> head_reader(7)
âœ“ PutWriter(3, 0) -> put_writer(3, 0)
âœ“ PutReader(4, 1) -> put_reader(4, 1)
âœ“ UnifyWriter(2) -> unify_writer(2)
âœ“ UnifyReader(6) -> unify_reader(6)
âœ“ SetWriter(1) -> set_writer(1)
âœ“ SetReader(8) -> set_reader(8)
âœ“ IfWriter(9) -> if_writer(9)
âœ“ IfReader(10) -> if_reader(10)

âœ“ All 10 instruction types migrated correctly

00:00 [32m+40[0m[31m -4[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 1: Individual instruction migration[0m                                                          00:00 [32m+40[0m[31m -4[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 2: Program migration - simple unification[0m                                                    00:00 [32m+40[0m[31m -4[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 2: Program migration - simple unification[0m                                                    

=== TEST 2: Program Migration - Simple Unification ===

Original program: 9 instructions
00:00 [32m+40[0m[31m -5[0m: [1m[90mloading test/custom/metainterp_merge_test.dart[0m [1m[31m[E][0m[0m                                                                                                                                       
  [31mFailed to load "test/custom/metainterp_merge_test.dart":[0m
  test/custom/metainterp_merge_test.dart:219:25: Error: The method 'isVarBound' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing method, or defining a method named 'isVarBound'.
              if (rt.heap.isVarBound(varId)) {
                          ^^^^^^^^^^
  test/custom/metainterp_merge_test.dart:220:41: Error: The method 'valueOfVar' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing method, or defining a method named 'valueOfVar'.
                final headValue = rt.heap.valueOfVar(varId);
                                          ^^^^^^^^^^
  test/custom/metainterp_merge_test.dart:237:25: Error: The method 'isVarBound' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing method, or defining a method named 'isVarBound'.
              if (rt.heap.isVarBound(tailVarId)) {
                          ^^^^^^^^^^
  test/custom/metainterp_merge_test.dart:238:41: Error: The method 'valueOfVar' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing method, or defining a method named 'valueOfVar'.
                final tailValue = rt.heap.valueOfVar(tailVarId);
                                          ^^^^^^^^^^
  test/custom/metainterp_merge_test.dart:249:33: Error: The method 'isVarBound' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing method, or defining a method named 'isVarBound'.
                      if (rt.heap.isVarBound(tailHeadVarId)) {
                                  ^^^^^^^^^^
  test/custom/metainterp_merge_test.dart:250:53: Error: The method 'valueOfVar' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing method, or defining a method named 'valueOfVar'.
                        final tailHeadValue = rt.heap.valueOfVar(tailHeadVarId);
                                                      ^^^^^^^^^^
  test/custom/metainterp_merge_test.dart:264:33: Error: The method 'isVarBound' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing method, or defining a method named 'isVarBound'.
                      if (rt.heap.isVarBound(tailTailVarId)) {
                                  ^^^^^^^^^^
  test/custom/metainterp_merge_test.dart:265:53: Error: The method 'valueOfVar' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing method, or defining a method named 'valueOfVar'.
                        final tailTailValue = rt.heap.valueOfVar(tailTailVarId);
                                                      ^^^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/custom/metainterp_merge_test.dart -p vm --plain-name 'loading test/custom/metainterp_merge_test.dart'
00:00 [32m+40[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 2: Program migration - simple unification[0m                                                    
Migration Statistics:
  Total instructions: 9
  Migrated to v2: 2
  Kept as v1: 7
  Migration rate: 22.2%
  Instruction breakdown:
    Label: 2
    ClauseTry: 1
    head_reader: 1
    Commit: 1
    put_writer: 1
    Spawn: 1
    Proceed: 1
    SuspendEnd: 1

âœ“ Found migrated HeadVariable(1, isReader: true) at PC 2
âœ“ Found migrated PutVariable(1, 0, isReader: false) at PC 4

âœ“ Program migration successful

00:00 [32m+41[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 2: Program migration - simple unification[0m                                                    00:00 [32m+41[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 3: Program migration - structure building[0m                                                    00:00 [32m+41[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 3: Program migration - structure building[0m                                                    

=== TEST 3: Program Migration - Structure Building ===

Original program: 9 instructions
Migration Statistics:
  Total instructions: 9
  Migrated to v2: 2
  Kept as v1: 7
  Migration rate: 22.2%
  Instruction breakdown:
    Label: 2
    ClauseTry: 1
    HeadStructure: 1
    unify_writer: 1
    unify_reader: 1
    Commit: 1
    Proceed: 1
    SuspendEnd: 1

âœ“ Found migrated UnifyVariable(1, isReader: false) at PC 3
âœ“ Found migrated UnifyVariable(2, isReader: true) at PC 4

âœ“ Structure building migration successful

00:00 [32m+42[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 3: Program migration - structure building[0m                                                    00:00 [32m+42[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 4: Program migration - guard instructions[0m                                                    00:00 [32m+42[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 4: Program migration - guard instructions[0m                                                    

=== TEST 4: Program Migration - Guard Instructions ===

Migration Statistics:
  Total instructions: 10
  Migrated to v2: 2
  Kept as v1: 8
  Migration rate: 20.0%
  Instruction breakdown:
    Label: 2
    ClauseTry: 1
    GetVariable: 2
    if_writer: 1
    if_reader: 1
    Commit: 1
    Proceed: 1
    SuspendEnd: 1

âœ“ Found migrated IfVariable(1, isReader: false) at PC 4
âœ“ Found migrated IfVariable(2, isReader: true) at PC 5

âœ“ Guard instruction migration successful

00:00 [32m+43[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 4: Program migration - guard instructions[0m                                                    00:00 [32m+43[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 5: Non-migrateable instructions preserved[0m                                                    00:00 [32m+43[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 5: Non-migrateable instructions preserved[0m                                                    

=== TEST 5: Non-Migrateable Instructions Preserved ===

Migration Statistics:
  Total instructions: 9
  Migrated to v2: 0
  Kept as v1: 9
  Migration rate: 0.0%
  Instruction breakdown:
    Label: 2
    ClauseTry: 1
    HeadConstant: 1
    Commit: 1
    PutConstant: 1
    Spawn: 1
    Proceed: 1
    SuspendEnd: 1

âœ“ All non-migrateable instructions preserved as v1

00:00 [32m+44[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 5: Non-migrateable instructions preserved[0m                                                    00:00 [32m+44[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 6: Mixed program migration[0m                                                                   00:00 [32m+44[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 6: Mixed program migration[0m                                                                   

=== TEST 6: Mixed Program Migration ===

Migration Statistics:
  Total instructions: 12
  Migrated to v2: 3
  Kept as v1: 9
  Migration rate: 25.0%
  Instruction breakdown:
    Label: 2
    ClauseTry: 1
    HeadConstant: 1
    GetVariable: 1
    head_reader: 1
    Commit: 1
    put_reader: 1
    put_writer: 1
    Spawn: 1
    Proceed: 1
    SuspendEnd: 1

âœ“ Mixed program correctly migrated

  Migration rate: 25.0%
00:00 [32m+45[0m[31m -5[0m: test/refactoring/instruction_migration_test.dart: Phase 2: Instruction Migration Tests Test 6: Mixed program migration[0m                                                                   00:00 [32m+45[0m[31m -5[0m: [1m[90mloading test/custom/merge_123_ab_test.dart[0m[0m                                                                                                                                               00:00 [32m+45[0m[31m -5[0m: test/custom/merge_123_ab_test.dart: Merge: merge([1,2,3],[a,b],Xs) with full trace[0m                                                                                                       00:00 [32m+45[0m[31m -5[0m: test/custom/merge_123_ab_test.dart: Merge: merge([1,2,3],[a,b],Xs) with full trace[0m                                                                                                       

======================================================================
MERGE TEST: merge([1,2,3], [a,b], Xs)
Expected: Xs = [1, a, 2, b, 3] (alternating elements)
======================================================================

HEAP SETUP:
  List1 (ID=10) = [1,2,3]
  List2 (ID=20) = [a,b]
  Result Xs (ID=30) = unbound

======================================================================
EXECUTION TRACE
======================================================================

Starting goal 100: merge(R10, R20, W30)

00:00 [32m+45[0m[31m -5[0m: test/custom/simple_metainterp_test.dart: Simple metainterpreter: run(p(X)) with clause(p(a), true)[0m                                                                                       

======================================================================
SIMPLE METAINTERPRETER TEST
Object program: clause(p(a), true).
Metainterpreter: run(true). run(A) :- otherwise | clause(A?,B), run(B?).
Goal: run(p(X))
Expected: X binds to a
======================================================================

HEAP SETUP:
  Variable 1 (X) - single ID for writer and reader

PROGRAM LABELS:
  clause/2 => PC 0
  clause/2_end => PC 7
  run/1 => PC 9
  run/1_clause2 => PC 15
  run/1_end => PC 25

Goal: run(p(X)) at PC 9

00:00 [32m+45[0m[31m -5[0m: test/custom/merge_123_ab_test.dart: Merge: merge([1,2,3],[a,b],Xs) with full trace[0m                                                                                                       

======================================================================
RESULTS
======================================================================
Goals executed: [100]
Xs bound: true
Xs value: .(Const(1),W1000)

Extracted list: [1, a, 2, b, 3]

Expected: [1, a, 2, b, 3]
00:00 [32m+46[0m[31m -5[0m: test/custom/simple_metainterp_test.dart: Simple metainterpreter: run(p(X)) with clause(p(a), true)[0m                                                                                       00:00 [32m+46[0m[31m -5[0m: test/custom/simple_metainterp_test.dart: Simple metainterpreter: run(p(X)) with clause(p(a), true)[0m                                                                                       
Goals executed: [100, 10000, 100]
Total executions: 3

======================================================================
RESULTS
======================================================================
X (Var1) bound: true
00:00 [32m+46[0m[31m -5[0m: test/custom/list_test.dart: List matching: first([a|_], X) extracts head[0m                                                                                                                 

=== Testing List Head Extraction ===
Program: first([a|_], X).
Goal: first(L, X) where L=[a,b] and X is writer

00:00 [32m+46[0m[31m -5[0m: test/custom/simple_metainterp_test.dart: Simple metainterpreter: run(p(X)) with clause(p(a), true)[0m                                                                                       
X value: Const(a)
00:00 [32m+46[0m[31m -5[0m: test/custom/list_test.dart: List matching: first([a|_], X) extracts head[0m                                                                                                                 
Heap Setup:
  Writer 1 (X) - unbound
00:00 [32m+46[0m[31m -5[0m: test/custom/simple_metainterp_test.dart: Simple metainterpreter: run(p(X)) with clause(p(a), true)[0m                                                                                       
âœ“ X correctly bound to a

âœ“ Metainterpreter successfully executed!
00:00 [32m+46[0m[31m -5[0m: test/custom/list_test.dart: List matching: first([a|_], X) extracts head[0m                                                                                                                 
  List L = [a, b] = .(Const(a),.(Const(b),Const(null)))

00:00 [32m+47[0m[31m -5[0m: test/custom/list_test.dart: List matching: first([a|_], X) extracts head[0m                                                                                                                 00:00 [32m+47[0m[31m -5[0m: test/custom/list_test.dart: List matching: first([a|_], X) extracts head[0m                                                                                                                 
--- Executing Goal: first([a,b], X) ---
Expected: X will be bound to 'a' (head of list)

00:00 [32m+47[0m[31m -5[0m: test/custom/metainterp_conj_test.dart: Metainterpreter with conjunction: run((p(X), q(X?)))[0m                                                                                              

======================================================================
METAINTERPRETER TEST: CONJUNCTION
Object program: clause(p(a),true). clause(q(a),true).
Metainterpreter:
  run(true).
  run((A,B)) :- run(A?), run(B?).
  run(A) :- otherwise | clause(A?,B), run(B?).
Query: run((p(X), q(X?)))
Expected: X binds to a, both p(a) and q(a) succeed
======================================================================

HEAP SETUP:
  Variable 1 (X) - single ID for writer and reader

PROGRAM LABELS:
  clause/2 => PC 0
  clause/2_c2 => PC 8
  clause/2_end => PC 15
  run/1 => PC 17
  run/1_c2 => PC 23
  run/1_c3 => PC 34
  run/1_end => PC 44

STRUCTURES:
  p(X) = writer 10 bound to p(Var1)
  q(X?) = writer 12 bound to q(Var1 as reader)
  (p(X), q(X?)) = reader 14 bound to ,(Var10, Var12)

Starting: run((p(X), q(X?))) at PC 17

00:00 [32m+47[0m[31m -5[0m: test/custom/list_test.dart: List matching: first([a|_], X) extracts head[0m                                                                                                                 
Goals executed: [100]
Writer 1 bound? false
00:00 [32m+47[0m[31m -7[0m: [1m[90mloading test/custom/metainterp_circular_merge_test.dart[0m [1m[31m[E][0m[0m                                                                                                                              
  [31mFailed to load "test/custom/metainterp_circular_merge_test.dart":[0m
  test/custom/metainterp_circular_merge_test.dart:232:56: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
              final wid = rt.heap.writerIdForReader(head.readerId);
                                                         ^^^^^^^^
  test/custom/metainterp_circular_merge_test.dart:250:56: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
              final wid = rt.heap.writerIdForReader(head.readerId);
                                                         ^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/custom/metainterp_circular_merge_test.dart -p vm --plain-name 'loading test/custom/metainterp_circular_merge_test.dart'
00:00 [32m+47[0m[31m -7[0m: test/custom/metainterp_conj_test.dart: Metainterpreter with conjunction: run((p(X), q(X?)))[0m                                                                                              

Goals executed: [100, 10000, 10001, 10002, 10001, 10000, 100]
Total executions: 7

======================================================================
RESULTS
======================================================================
X (Var1) bound: true
X value: Const(a)
âœ“ X correctly bound to a

âœ“ Metainterpreter with conjunction passed!
âœ“ run((p(X), q(X?))) executed successfully
âœ“ p(X) bound X to a
âœ“ q(X?) verified q(a)
00:00 [32m+48[0m[31m -7[0m: test/custom/metainterp_conj_test.dart: Metainterpreter with conjunction: run((p(X), q(X?)))[0m                                                                                              00:00 [32m+48[0m[31m -7[0m: test/custom/list_test.dart: List matching: first([a|_], X) extracts head [1m[31m[E][0m[0m                                                                                                             
  Expected: <true>
    Actual: <false>
  X should be bound
  
  package:matcher                  expect
  test/custom/list_test.dart 94:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/list_test.dart -p vm --plain-name 'List matching: first([a|_], X) extracts head'
00:00 [32m+48[0m[31m -7[0m: test/custom/list_test.dart: List matching: is_cons([a|b]) checks non-empty list[0m                                                                                                          00:00 [32m+48[0m[31m -7[0m: test/custom/list_test.dart: List matching: is_cons([a|b]) checks non-empty list[0m                                                                                                          

=== Testing List Cons Check ===
Program: is_cons([_|_]).
Goal: is_cons([a,b,c])

Heap Setup:
  List L = [a, b, c]

--- Executing Goal: is_cons([a,b,c]) ---
Expected: SUCCESS (list is non-empty)

Goals executed: [100]

âœ“ List cons check succeeded
âœ“ Test passed!
00:00 [32m+49[0m[31m -7[0m: test/custom/metainterp_pq_test.dart: Metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                        00:00 [32m+49[0m[31m -7[0m: test/custom/list_test.dart: List matching: is_cons([]) fails on empty list[0m                                                                                                               

=== Testing Empty List Rejection ===
Program: is_cons([_|_]).
Goal: is_cons([])

Heap Setup:
  List L = []

--- Executing Goal: is_cons([]) ---
Expected: FAIL (empty list is not a cons)

Goals executed: [100]

âœ“ Empty list correctly rejected
âœ“ Test passed!
00:00 [32m+50[0m[31m -7[0m: test/custom/metainterp_pq_test.dart: Metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                        00:00 [32m+50[0m[31m -7[0m: test/custom/list_test.dart: List construction: cons(X, Xs, [X|Xs]) builds list[0m                                                                                                           

=== Testing List Construction ===
Program: cons(X, Xs, [X|Xs]).
Goal: cons(a, [b], Z) where Z is writer

Heap Setup:
  X = a
  Xs = [b]
  Z (result) - unbound

--- Executing Goal: cons(a, [b], Z) ---
Expected: Z will be bound to [a, b]

00:00 [32m+50[0m[31m -7[0m: test/custom/metainterp_pq_test.dart: Metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                        

======================================================================
METAINTERPRETER TEST: P/Q PROGRAM
Object program: p(a). p(b). q(b).
Meta-level goal: run(p(X)), run(q(X?))
Expected: X binds to a (first clause of p), q(a) fails
======================================================================

00:00 [32m+50[0m[31m -7[0m: test/custom/list_test.dart: List construction: cons(X, Xs, [X|Xs]) builds list[0m                                                                                                           
Goals executed: [100]
Writer 1 bound? true
Writer 1 value: .(R4?,R6?)

00:00 [32m+50[0m[31m -7[0m: test/custom/metainterp_pq_test.dart: Metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                        
HEAP SETUP:
  Writer 1 (X) paired with Reader 2 (X?)

00:00 [32m+50[0m[31m -8[0m: test/custom/metainterp_pq_test.dart: Metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                        
======================================================================
TEST 1: run(true) - should succeed immediately
======================================================================

00:00 [32m+50[0m[31m -8[0m: test/custom/list_test.dart: List construction: cons(X, Xs, [X|Xs]) builds list [1m[31m[E][0m[0m                                                                                                       
  Expected: <Instance of 'ConstTerm'>
    Actual: <null>
     Which: is not an instance of 'ConstTerm'
  
  package:matcher                   expect
  test/custom/list_test.dart 312:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/list_test.dart -p vm --plain-name 'List construction: cons(X, Xs, [X|Xs]) builds list'
00:00 [32m+50[0m[31m -8[0m: test/custom/list_test.dart: List matching: match concrete list [a, b][0m                                                                                                                    

=== Testing Concrete List Matching ===
Program: p([a, b]).
Goal: p(X) where X is writer

Heap Setup:
  Writer 1 (X) - unbound

--- Executing Goal: p(X) ---
Expected: X will be bound to [a, b]

Goals executed: [100]
Writer 1 bound? true
Writer 1 value: .(Const(a),.(Const(b),Const(null)))

âœ“ List correctly constructed: [a, b]
âœ“ Test passed!
00:00 [32m+51[0m[31m -8[0m: test/custom/metainterp_pq_test.dart: Metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                        00:00 [32m+51[0m[31m -8[0m: test/custom/metainterp_pq_test.dart: Metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                        
Goals executed: [100]
âœ“ run(true) succeeded

======================================================================
TEST 2: run(p(X)) with otherwise guard
======================================================================

Goals executed: [200]
âœ“ run(p(X)) succeeded via otherwise clause

======================================================================
RESULTS
======================================================================
âœ“ Otherwise guard working correctly
âœ“ First clause run(true) matches literal
âœ“ Second clause run(A) with otherwise handles non-true terms
00:00 [32m+52[0m[31m -8[0m: test/custom/metainterp_pq_test.dart: Metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                        00:00 [32m+52[0m[31m -8[0m: [1m[90mloading test/custom/playground_test.dart[0m[0m                                                                                                                                                 00:00 [32m+52[0m[31m -8[0m: test/custom/playground_test.dart: Playground: write your own goal here[0m                                                                                                                   00:00 [32m+52[0m[31m -8[0m: test/custom/playground_test.dart: Playground: write your own goal here[0m                                                                                                                   

=== My Custom Goal ===

Program: p(a).
Goal: p(X) where X is unbound writer

--- Running goal ---

Goals executed: [100]

=== Results ===
X (writer 1) bound? true
X value: Const(a)

âœ“ Done!
00:00 [32m+53[0m[31m -8[0m: test/custom/metainterp_rp_test.dart: Metainterpreter: run(p(X?)), run(p(X)) - reader then writer[0m                                                                                         00:00 [32m+53[0m[31m -8[0m: test/custom/metainterp_rp_test.dart: Metainterpreter: run(p(X?)), run(p(X)) - reader then writer[0m                                                                                         

======================================================================
METAINTERPRETER TEST: P(X?) THEN P(X)
Object program: clause(p(a),true). clause(p(b),true).
Metainterpreter: run(true). run(A) :- otherwise | clause(A?,B), run(B?).
Query: boot :- run(p(X?)), run(p(X))
Expected: First run(p(X?)) suspends, second run(p(X)) binds X=a, first reactivates
======================================================================

HEAP SETUP:
  Writer 1 (X) paired with Reader 2 (X?)

PROGRAM LABELS:
  clause/2 => PC 0
  clause/2_c2 => PC 7
  clause/2_end => PC 14
  run/1 => PC 16
  run/1_c2 => PC 21
  run/1_end => PC 31
  boot/0 => PC 33
  boot/0_end => PC 42

STRUCTURES:
  p(X?) = reader 11 bound to p(R2)
  p(X) = reader 13 bound to p(W1)

Starting: boot(p(X?), p(X)) at PC 33


Goals executed: [100, 10000]
Total executions: 2

======================================================================
RESULTS
======================================================================
X (W1) bound: false
00:00 [32m+53[0m[31m -8[0m: test/custom/simple_p_q_test.dart: Simple p/q: p(a). q(a). Goal: q(X?), p(X) succeeds with X=a[0m                                                                                            

=== SIMPLE P/Q TEST ===
Program: p(a). q(a).
Goal: q(X?), p(X)
Expected: X binds to a, q(a) succeeds

Heap: Writer 1 (X) paired with Reader 2 (X?)

Step 1: Run q(X?) where X is unbound
00:00 [32m+53[0m[31m -9[0m: test/custom/simple_p_q_test.dart: Simple p/q: p(a). q(a). Goal: q(X?), p(X) succeeds with X=a[0m                                                                                            00:00 [32m+53[0m[31m -9[0m: test/custom/trace_q_p_test.dart: Program: p(a). p(b). q(b). Goal: q(X?), p(X) with full trace[0m                                                                                            

========================================
=== PROGRAM ===
p(a).
p(b).
q(b).

=== GOAL ===
q(X?), p(X)
========================================

HEAP SETUP:
  Writer 1 (X) - unbound
  Reader 2 (X?) - paired with Writer 1

00:00 [32m+53[0m[31m -9[0m: test/custom/simple_p_q_test.dart: Simple p/q: p(a). q(a). Goal: q(X?), p(X) succeeds with X=a[0m                                                                                            
  Ran goals: [100]
00:00 [32m+53[0m[31m -9[0m: test/custom/trace_q_p_test.dart: Program: p(a). p(b). q(b). Goal: q(X?), p(X) with full trace[0m                                                                                            
========================================
GOAL 1: q(X?) where X is UNBOUND
00:00 [32m+53[0m[31m -9[0m: test/custom/simple_p_q_test.dart: Simple p/q: p(a). q(a). Goal: q(X?), p(X) succeeds with X=a[0m                                                                                            
  X bound? false
00:00 [32m+53[0m[31m -9[0m: test/custom/trace_q_p_test.dart: Program: p(a). p(b). q(b). Goal: q(X?), p(X) with full trace[0m                                                                                            
Expected: SUSPEND (reader X? is unbound)
========================================

00:00 [32m+53[0m[31m -9[0m: test/custom/simple_p_q_test.dart: Simple p/q: p(a). q(a). Goal: q(X?), p(X) succeeds with X=a[0m                                                                                            
  Suspended on R2? 1 goals

Step 2: Run p(X) where X is unbound writer
  Ran goals: [200, 100]
  X bound? true
  X value: Const(a)

âœ“ Success! X = a, both goals succeeded
âœ“ Goal q(X?) correctly ran with program Q after reactivation

00:00 [32m+54[0m[31m -9[0m: test/custom/trace_q_p_test.dart: Program: p(a). p(b). q(b). Goal: q(X?), p(X) with full trace[0m                                                                                            00:00 [32m+54[0m[31m -9[0m: test/custom/simple_p_q_test.dart: Simple p/q: p(b). q(a). Goal: q(X?), p(X) fails because p(b)â‰ q(a)[0m                                                                                      

=== SIMPLE P/Q TEST (MISMATCH) ===
Program: p(b). q(a).
Goal: q(X?), p(X)
Expected: X binds to b, q(b) fails

Step 1: Run q(X?)
Step 2: Run p(X) - binds X to b
  Ran goals: [200, 100]
  X value: Const(b)

âœ“ Correct behavior: X = b, q(a) failed as expected
âœ“ Goal q(X?) correctly ran with program Q and failed

00:00 [32m+55[0m[31m -9[0m: test/custom/trace_q_p_test.dart: Program: p(a). p(b). q(b). Goal: q(X?), p(X) with full trace[0m                                                                                            00:00 [32m+55[0m[31m -9[0m: test/custom/metainterp_rp_test.dart: Metainterpreter: run(p(X?)), run(p(X)) - reader then writer [1m[31m[E][0m[0m                                                                                     
  Expected: <true>
    Actual: <false>
  X should be bound
  
  package:matcher                            expect
  test/custom/metainterp_rp_test.dart 144:5  main.<fn>
  
00:00 [32m+55[0m[31m -9[0m: test/custom/trace_q_p_test.dart: Program: p(a). p(b). q(b). Goal: q(X?), p(X) with full trace[0m                                                                                            

RESULT OF GOAL 1:
  Goals executed: [100]
  X bound: false
  Suspended on R2: 1 goals

========================================
GOAL 2: p(X) where X is UNBOUND WRITER
Expected: BIND X to 'a' (first clause)
Then: ACTIVATE suspended goal q(X?)

[1m[36mTo run this test again:[0m dart test test/custom/metainterp_rp_test.dart -p vm --plain-name 'Metainterpreter: run(p(X?)), run(p(X)) - reader then writer'
========================================


RESULT OF GOAL 2:
  Goals executed: [200, 100]
  X bound: true
  X value: Const(a)
  Goals in queue: 0

========================================
GOAL 1 REACTIVATED: q(X?) where X is now bound to 'a'
Expected: FAIL (q only has clause q(b), not q(a))
========================================


RESULT OF REACTIVATED GOAL:
  Goals executed: []
========================================
=== EXECUTION SUMMARY ===
========================================
1. GOAL q(X?): Suspended (X unbound)
2. GOAL p(X): Bound X to 'a' via first clause p(a)
3. ACTIVATION: q(X?) woke up
4. REACTIVATED q(X?): FAILED (q(b) does not match q(a))

FINAL STATE: X = Const(a)
========================================

00:00 [32m+56[0m[31m -9[0m: test/custom/echo_test.dart: echo: read line and echo back with proper sequencing[0m                                                                                                         00:00 [32m+56[0m[31m -10[0m: [1m[90mloading test/custom/merge_test.dart[0m [1m[31m[E][0m[0m                                                                                                                                                 
  [31mFailed to load "test/custom/merge_test.dart":[0m
  test/custom/merge_test.dart:190:30: Error: 'ReaderTerm' isn't a type.
      expect(list.args[1], isA<ReaderTerm>(), reason: 'Tail should be a reader reference');
                               ^^^^^^^^^^
  test/custom/merge_test.dart:191:41: Error: 'ReaderTerm' isn't a type.
      final tailReader = (list.args[1] as ReaderTerm).readerId;
                                          ^^^^^^^^^^
  test/custom/merge_test.dart:329:30: Error: 'ReaderTerm' isn't a type.
      expect(list.args[1], isA<ReaderTerm>(), reason: 'Tail should be a reader reference');
                               ^^^^^^^^^^
  test/custom/merge_test.dart:330:41: Error: 'ReaderTerm' isn't a type.
      final tailReader = (list.args[1] as ReaderTerm).readerId;
                                          ^^^^^^^^^^
  test/custom/merge_test.dart:461:30: Error: 'ReaderTerm' isn't a type.
      expect(list.args[1], isA<ReaderTerm>(), reason: 'Tail should be a reader');
                               ^^^^^^^^^^
  test/custom/merge_test.dart:462:42: Error: 'ReaderTerm' isn't a type.
      final tail1Reader = (list.args[1] as ReaderTerm).readerId;
                                           ^^^^^^^^^^
  test/custom/merge_test.dart:475:37: Error: 'ReaderTerm' isn't a type.
        expect(tail1List.args[1], isA<ReaderTerm>(), reason: 'Tail of tail should be reader');
                                      ^^^^^^^^^^
  test/custom/merge_test.dart:476:49: Error: 'ReaderTerm' isn't a type.
        final tail2Reader = (tail1List.args[1] as ReaderTerm).readerId;
                                                  ^^^^^^^^^^
  test/custom/merge_test.dart:632:63: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
            final tailWriterId = rt.heap.writerIdForReader(tail.readerId);
                                                                ^^^^^^^^
  test/custom/merge_test.dart:832:63: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
            final tailWriterId = rt.heap.writerIdForReader(tail.readerId);
                                                                ^^^^^^^^
  test/custom/merge_test.dart:1039:63: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
            final tailWriterId = rt.heap.writerIdForReader(tail.readerId);
                                                                ^^^^^^^^
  test/custom/merge_test.dart:1268:63: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
            final tailWriterId = rt.heap.writerIdForReader(tail.readerId);
                                                                ^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/custom/merge_test.dart -p vm --plain-name 'loading test/custom/merge_test.dart'
00:00 [32m+56[0m[31m -10[0m: test/custom/echo_test.dart: echo: read line and echo back with proper sequencing[0m                                                                                                        

=== ECHO TEST ===
Note: This test simulates input instead of blocking on stdin

Running echo program:
(Input pre-bound to: "hello world")

00:00 [32m+56[0m[31m -11[0m: [1m[90mloading test/custom/system_predicates_test.dart[0m [1m[31m[E][0m[0m                                                                                                                                     
  [31mFailed to load "test/custom/system_predicates_test.dart":[0m
  test/custom/system_predicates_test.dart:40:28: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final time = rt.heap.writerValue[wT];
                             ^^^^^^^^^^^
  test/custom/system_predicates_test.dart:67:32: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
          final idTerm = rt.heap.writerValue[wId];
                                 ^^^^^^^^^^^
  test/custom/system_predicates_test.dart:138:36: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final contentsTerm = rt.heap.writerValue[wContents];
                                     ^^^^^^^^^^^
  test/custom/system_predicates_test.dart:225:36: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final contentsTerm = rt.heap.writerValue[wContents];
                                     ^^^^^^^^^^^
  test/custom/system_predicates_test.dart:264:36: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final contentsTerm = rt.heap.writerValue[wContents];
                                     ^^^^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/custom/system_predicates_test.dart -p vm --plain-name 'loading test/custom/system_predicates_test.dart'
Enter text: You entered: hello world
00:00 [32m+56[0m[31m -11[0m: test/custom/echo_test.dart: echo: read line and echo back with proper sequencing[0m                                                                                                        

Result: RunResult.terminated
âœ“ echo program executed successfully

00:00 [32m+57[0m[31m -11[0m: test/custom/echo_test.dart: echo: read line and echo back with proper sequencing[0m                                                                                                        00:00 [32m+57[0m[31m -11[0m: [1m[90mloading test/custom/merge_reverse_order_test.dart[0m[0m                                                                                                                                       00:00 [32m+57[0m[31m -11[0m: test/custom/merge_reverse_order_test.dart: Reverse order: merge(Xs?,[a,b,c,d],Ys), merge([1,2,3],[],Xs)[0m                                                                                 00:00 [32m+57[0m[31m -11[0m: test/custom/merge_reverse_order_test.dart: Reverse order: merge(Xs?,[a,b,c,d],Ys), merge([1,2,3],[],Xs)[0m                                                                                 

======================================================================
REVERSE ORDER SEQUENTIAL MERGE TEST
Goal 100: merge(Xs?, [a,b,c,d], Ys)  <- Xs unbound, should SUSPEND
Goal 200: merge([1,2,3], [], Xs)     <- Binds Xs, ACTIVATES Goal 100
Expected: Xs = [1,2,3], Ys = [1,a,2,b,3,c,d]
======================================================================

HEAP SETUP:
  List1 (W10/R10) = [1,2,3]
  Empty (W20/R20) = []
  List2 (W30/R30) = [a,b,c,d]
  Result Xs (W40/R40) = unbound
  Result Ys (W50/R50) = unbound

======================================================================
EXECUTION TRACE
======================================================================

--- GOAL 100: merge(Xs?, [a,b,c,d], Ys) ---
    (Xs? is unbound, this should SUSPEND)
--- GOAL 200: merge([1,2,3], [], Xs) ---
    (This will bind Xs and ACTIVATE goal 100)

Queue order: [100, 200]
Expected execution: 100 suspends, 200 runs and binds Xs, 100 reactivates

00:00 [32m+57[0m[31m -11[0m: test/custom/metainterp_three_way_circular_test.dart: Metainterpreter three-way circular: run((merge([a|Xs?],Ys?,Zs), merge([b|Ys?],Zs?,Xs), merge([c|Zs?],Xs?,Ys)))[0m                     

======================================================================
METAINTERPRETER TEST: THREE-WAY CIRCULAR MERGE
Object program:
  clause(merge([X|Xs],Ys,[X?|Zs?]), merge(Ys?,Xs?,Zs)).
  clause(merge(Xs,[Y|Ys],[Y?|Zs?]), merge(Xs?,Ys?,Zs)).
  clause(merge([],[],[]), true).
Metainterpreter:
  run(true).
  run((A,B)) :- run(A?), run(B?).
  run(A) :- otherwise | clause(A?,B), run(B?).
Query: run((merge([a|Xs?],Ys?,Zs), merge([b|Ys?],Zs?,Xs), merge([c|Zs?],Xs?,Ys)))
Expected: Creates infinite circular streams
  Xs tail depends on Zs which depends on Xs (circular)
  Ys tail depends on Xs which depends on Ys (circular)
  Zs tail depends on Ys which depends on Zs (circular)
======================================================================

HEAP SETUP:
  Writer 1 (Xs) paired with Reader 2 (Xs?)
  Writer 3 (Ys) paired with Reader 4 (Ys?)
  Writer 5 (Zs) paired with Reader 6 (Zs?)

PROGRAM LABELS:
  clause/2 => PC 0
  clause/2_c2 => PC 18
  clause/2_c3 => PC 36
  clause/2_end => PC 45
  run/1 => PC 47
  run/1_c2 => PC 52
  run/1_c3 => PC 62
  run/1_end => PC 72

STRUCTURES:
  [a|Xs?] = writer 10
  [b|Ys?] = writer 12
  [c|Zs?] = writer 14
  merge([a|Xs?], Ys?, Zs) = writer 16
  merge([b|Ys?], Zs?, Xs) = writer 18
  merge([c|Zs?], Xs?, Ys) = writer 20

Starting goal at PC 47

00:00 [32m+57[0m[31m -11[0m: test/custom/merge_reverse_order_test.dart: Reverse order: merge(Xs?,[a,b,c,d],Ys), merge([1,2,3],[],Xs)[0m                                                                                 
WARNING: PutReader got unexpected value: W1005

======================================================================
RESULTS
======================================================================
Goals executed in order: [100, 200, 100]
Total executions: 3

Xs (W40) bound: true
Xs = [1, 2, 3]

Ys (W50) bound: true
Ys = [a, b, c, d, 1]
00:00 [32m+57[0m[31m -11[0m: test/custom/clause_only_test.dart: Simple clause/2: clause(p(a), true)[0m                                                                                                                  

======================================================================
SIMPLE CLAUSE TEST
Program: clause(p(a), true).
Goal: clause(p(X), Y)
Expected: X binds to a, Y binds to true
======================================================================

HEAP SETUP:
  Writer 1 (X) paired with Reader 2 (X?)
  Writer 3 (Y) paired with Reader 4 (Y?)

00:00 [32m+57[0m[31m -12[0m: test/custom/clause_only_test.dart: Simple clause/2: clause(p(a), true)[0m                                                                                                                  
PROGRAM:
  PC 0: Instance of 'Label'
  PC 1: Instance of 'ClauseTry'
  PC 2: Instance of 'HeadStructure'
  PC 3: Instance of 'UnifyConstant'
  PC 4: Instance of 'HeadConstant'
  PC 5: Instance of 'Commit'
  PC 6: Instance of 'Proceed'
  PC 7: Instance of 'Label'
  PC 8: Instance of 'SuspendEnd'

Goal: clause(p(X), Y) at PC 0
CallEnv: readers={{0: 11}}, writers={{1: 3}}

Checking arguments:
  env.r(0) = 11 (should be rPX=11)
  env.r(1) = null (should be null)
  env.w(0) = null (should be null)
  env.w(1) = 3 (should be wY=3)

00:00 [32m+57[0m[31m -12[0m: test/custom/metainterp_three_way_circular_test.dart: Metainterpreter three-way circular: run((merge([a|Xs?],Ys?,Zs), merge([b|Ys?],Zs?,Xs), merge([c|Zs?],Xs?,Ys)))[0m                     

Goals executed: 1 executions

======================================================================
RESULTS
======================================================================
Xs (W1) bound: false
Ys (W3) bound: false
Zs (W5) bound: false

âœ“ Three-way circular merge test complete
Note: This creates infinite circular streams - execution limited by maxCycles
00:00 [32m+58[0m[31m -12[0m: test/custom/clause_only_test.dart: Simple clause/2: clause(p(a), true)[0m                                                                                                                  00:00 [32m+58[0m[31m -12[0m: test/custom/clause_only_test.dart: Simple clause/2: clause(p(a), true)[0m                                                                                                                  
Result: RunResult.suspended

======================================================================
RESULTS
======================================================================
X (W1) bound: false
Y (W3) bound: false
00:00 [32m+58[0m[31m -13[0m: test/custom/merge_reverse_order_test.dart: Reverse order: merge(Xs?,[a,b,c,d],Ys), merge([1,2,3],[],Xs) [1m[31m[E][0m[0m                                                                             
  Expected: <7>
    Actual: <5>
  Should have 7 elements total
  
  package:matcher                                  expect
  test/custom/merge_reverse_order_test.dart 245:7  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/merge_reverse_order_test.dart -p vm --plain-name 'Reverse order: merge(Xs?,[a,b,c,d],Ys), merge([1,2,3],[],Xs)'
00:00 [32m+58[0m[31m -13[0m: test/custom/merge_three_way_circular_direct_test.dart: Three-way circular merge (direct): merge([a|Xs?],Ys?,Zs), merge([b|Ys?],Zs?,Xs), merge([c|Zs?],Xs?,Ys)[0m                           

======================================================================
THREE-WAY CIRCULAR MERGE (DIRECT - NO METAINTERPRETER)
Goals:
  Goal 100: merge([a|Xs?], Ys?, Zs)
  Goal 200: merge([b|Ys?], Zs?, Xs)
  Goal 300: merge([c|Zs?], Xs?, Ys)
Expected: Creates infinite circular streams
  Xs = [b, c, b, c, ...]  (from merge 2 output)
  Ys = [c, a, c, a, ...]  (from merge 3 output)
  Zs = [a, b, a, b, ...]  (from merge 1 output)
======================================================================

HEAP SETUP:
  Writer 1 (Xs) paired with Reader 1 (Xs?)
  Writer 3 (Ys) paired with Reader 3 (Ys?)
  Writer 5 (Zs) paired with Reader 5 (Zs?)

PROGRAM LABELS:
  merge/3_start => PC 0
  merge/3_clause2 => PC 14
  merge/3_clause3 => PC 28
  merge/3_end => PC 35

STRUCTURES:
  [a|Xs?] = writer 10
  [b|Ys?] = writer 12
  [c|Zs?] = writer 14

Starting three goals:
  Goal 100: merge([a|Xs?], Ys?, Zs)
  Goal 200: merge([b|Ys?], Zs?, Xs)
  Goal 300: merge([c|Zs?], Xs?, Ys)

00:00 [32m+58[0m[31m -13[0m: test/custom/clause_only_test.dart: Simple clause/2: clause(p(a), true) [1m[31m[E][0m[0m                                                                                                              
  Expected: <true>
    Actual: <false>
  X should be bound
  
  package:matcher                         expect
  test/custom/clause_only_test.dart 97:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/clause_only_test.dart -p vm --plain-name 'Simple clause/2: clause(p(a), true)'
00:00 [32m+58[0m[31m -13[0m: test/custom/merge_three_way_circular_direct_test.dart: Three-way circular merge (direct): merge([a|Xs?],Ys?,Zs), merge([b|Ys?],Zs?,Xs), merge([c|Zs?],Xs?,Ys)[0m                           
WARNING: PutReader got unexpected value: W1000
WARNING: PutReader got unexpected value: W1001
WARNING: PutReader got unexpected value: W1003

Goals executed: 5 executions

======================================================================
RESULTS
======================================================================
Xs (W1) bound: true
Ys (W3) bound: true
Zs (W5) bound: true
Xs value: .(Const(b),W1001)
Ys value: .(Const(c),W1003)
Zs value: .(Const(a),W1000)

âœ“ Three-way circular merge (direct) test complete
Note: This creates infinite circular streams - execution limited by maxCycles
00:00 [32m+59[0m[31m -13[0m: test/custom/merge_three_way_circular_direct_test.dart: Three-way circular merge (direct): merge([a|Xs?],Ys?,Zs), merge([b|Ys?],Zs?,Xs), merge([c|Zs?],Xs?,Ys)[0m                           00:00 [32m+59[0m[31m -13[0m: [1m[90mloading test/custom/metainterp_pp_test.dart[0m[0m                                                                                                                                             00:00 [32m+59[0m[31m -13[0m: test/custom/metainterp_pp_test.dart: Metainterpreter: run(p(X)), run(p(X?)) - writer then reader[0m                                                                                        00:00 [32m+59[0m[31m -13[0m: test/custom/metainterp_pp_test.dart: Metainterpreter: run(p(X)), run(p(X?)) - writer then reader[0m                                                                                        

======================================================================
METAINTERPRETER TEST: P(X) THEN P(X?)
Object program: clause(p(a),true). clause(p(b),true).
Metainterpreter: run(true). run(A) :- otherwise | clause(A?,B), run(B?).
Query: boot :- run(p(X)), run(p(X?))
Expected: First run(p(X)) binds X=a, second run(p(X?)) verifies p(a)
======================================================================

HEAP SETUP:
  Writer 1 (X) paired with Reader 2 (X?)

PROGRAM LABELS:
  clause/2 => PC 0
  clause/2_c2 => PC 7
  clause/2_end => PC 14
  run/1 => PC 16
  run/1_c2 => PC 21
  run/1_end => PC 31
  boot/0 => PC 33
  boot/0_end => PC 42

STRUCTURES:
  p(X) = reader 11 bound to p(W1)
  p(X?) = reader 13 bound to p(R2)

Starting: boot(p(X), p(X?)) at PC 33

00:00 [32m+59[0m[31m -13[0m: test/custom/metainterp_reversed_test.dart: Metainterpreter with reversed order: run((p(X?), p(X)))[0m                                                                                      

======================================================================
METAINTERPRETER TEST: REVERSED ORDER
Object program: clause(p(a),true). clause(q(a),true).
Metainterpreter:
  run(true).
  run((A,B)) :- run(A?), run(B?).
  run(A) :- otherwise | clause(A?,B), run(B?).
Query: run((p(X?), p(X)))
Expected: X binds to a, both p(X?) and p(X) succeed
Note: Reader comes FIRST, writer comes SECOND
======================================================================

HEAP SETUP:
  Writer 1 (X) paired with Reader 2 (X?)

PROGRAM LABELS:
  clause/2 => PC 0
  clause/2_c2 => PC 7
  clause/2_end => PC 14
  run/1 => PC 16
  run/1_c2 => PC 21
  run/1_c3 => PC 31
  run/1_end => PC 41

STRUCTURES:
  p(X?) = writer 10 bound to p(R2)
  p(X) = writer 12 bound to p(W1)
  (p(X?), p(X)) = reader 15 bound to ,(W10, W12)

Starting: run((p(X?), p(X))) at PC 16

00:00 [32m+59[0m[31m -13[0m: test/custom/metainterp_pp_test.dart: Metainterpreter: run(p(X)), run(p(X?)) - writer then reader[0m                                                                                        

Goals executed: [100, 10000]
Total executions: 2

======================================================================
RESULTS
======================================================================
X (W1) bound: false
00:00 [32m+59[0m[31m -14[0m: test/custom/metainterp_reversed_test.dart: Metainterpreter with reversed order: run((p(X?), p(X)))[0m                                                                                      

Goals executed: [100]
Total executions: 1

======================================================================
RESULTS
======================================================================
X (W1) bound: false
00:00 [32m+59[0m[31m -14[0m: test/custom/merge_sequential_123_abcd_test.dart: Sequential merge: merge([1,2,3],[],Xs), merge(Xs?,[a,b,c,d],Ys)[0m                                                                        

======================================================================
SEQUENTIAL MERGE TEST
Goal 1: merge([1,2,3], [], Xs)
Goal 2: merge(Xs?, [a,b,c,d], Ys)
Expected: Xs = [1,2,3], Ys = [1,a,2,b,3,c,d]
======================================================================

00:00 [32m+59[0m[31m -14[0m: test/custom/metainterp_reversed_test.dart: Metainterpreter with reversed order: run((p(X?), p(X)))[0m                                                                                      00:00 [32m+59[0m[31m -14[0m: test/custom/merge_sequential_123_abcd_test.dart: Sequential merge: merge([1,2,3],[],Xs), merge(Xs?,[a,b,c,d],Ys)[0m                                                                        
HEAP SETUP:
  List1 (W10/R10) = [1,2,3]
  Empty (W20/R20) = []
  List2 (W30/R30) = [a,b,c,d]
  Result Xs (W40/R40) = unbound
  Result Ys (W50/R50) = unbound

======================================================================
EXECUTION TRACE
======================================================================

--- GOAL 100: merge([1,2,3], [], Xs) ---
--- GOAL 200: merge(Xs?, [a,b,c,d], Ys) ---
(Goal 200 will suspend because Xs? is unbound)

00:00 [32m+59[0m[31m -15[0m: test/custom/struct_test.dart: Simple structure matching: p(f(a, b)) with writer[0m                                                                                                         

=== Testing Structure Matching ===
Program: p(f(a, b)).
Goal: p(X) where X is writer

Heap Setup:
  Writer 1 (X) - unbound

--- Executing Goal: p(X) ---
Expected: X (writer) will be bound to f(a, b) in ÏƒÌ‚w

00:01 [32m+59[0m[31m -15[0m: test/custom/metainterp_pp_test.dart: Metainterpreter: run(p(X)), run(p(X?)) - writer then reader [1m[31m[E][0m[0m                                                                                    
  Expected: <true>
    Actual: <false>
  X should be bound
  
  package:matcher                            expect
  test/custom/metainterp_pp_test.dart 144:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/metainterp_pp_test.dart -p vm --plain-name 'Metainterpreter: run(p(X)), run(p(X?)) - writer then reader'
00:01 [32m+59[0m[31m -15[0m: test/custom/merge_sequential_123_abcd_test.dart: Sequential merge: merge([1,2,3],[],Xs), merge(Xs?,[a,b,c,d],Ys)[0m                                                                        
WARNING: PutReader got unexpected value: W1000

======================================================================
RESULTS
======================================================================
Goals executed: [100, 200]
Total executions: 2

Xs (W40) bound: true
Xs = [1, 2, 3]

Ys (W50) bound: true
Ys = [1]
00:01 [32m+59[0m[31m -15[0m: test/custom/struct_test.dart: Simple structure matching: p(f(a, b)) with writer[0m                                                                                                         
Goals executed: [100]
Writer 1 bound? true
Writer 1 value: f(Const(a),Const(b))

00:01 [32m+59[0m[31m -16[0m: test/custom/struct_test.dart: Simple structure matching: p(f(a, b)) with writer[0m                                                                                                         
âœ“ Structure correctly built: f(a, b)
âœ“ Test passed!
00:01 [32m+59[0m[31m -16[0m: test/custom/metainterp_reversed_test.dart: Metainterpreter with reversed order: run((p(X?), p(X))) [1m[31m[E][0m[0m                                                                                  
  Expected: <true>
    Actual: <false>
  X should be bound
  
  package:matcher                                  expect
  test/custom/metainterp_reversed_test.dart 157:5  main.<fn>
  
00:01 [32m+60[0m[31m -16[0m: test/custom/struct_test.dart: Simple structure matching: p(f(a, b)) with writer[0m                                                                                                         
[1m[36mTo run this test again:[0m dart test test/custom/metainterp_reversed_test.dart -p vm --plain-name 'Metainterpreter with reversed order: run((p(X?), p(X)))'
00:01 [32m+60[0m[31m -16[0m: test/custom/struct_test.dart: Simple structure matching: p(f(a, b)) with bound reader[0m                                                                                                   00:01 [32m+60[0m[31m -17[0m: [1m[90mloading test/custom/file_handles_test.dart[0m [1m[31m[E][0m[0m                                                                                                                                          
  [31mFailed to load "test/custom/file_handles_test.dart":[0m
  test/custom/file_handles_test.dart:55:34: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handleTerm = rt.heap.writerValue[wHandle];
                                   ^^^^^^^^^^^
  test/custom/file_handles_test.dart:85:34: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handleTerm = rt.heap.writerValue[wHandle];
                                   ^^^^^^^^^^^
  test/custom/file_handles_test.dart:132:34: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handleTerm = rt.heap.writerValue[wHandle];
                                   ^^^^^^^^^^^
  test/custom/file_handles_test.dart:175:34: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handleTerm = rt.heap.writerValue[wHandle];
                                   ^^^^^^^^^^^
  test/custom/file_handles_test.dart:193:36: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final contentsTerm = rt.heap.writerValue[wContents];
                                     ^^^^^^^^^^^
  test/custom/file_handles_test.dart:235:34: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handleTerm = rt.heap.writerValue[wHandle];
                                   ^^^^^^^^^^^
  test/custom/file_handles_test.dart:291:35: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handleTerm1 = rt.heap.writerValue[wHandle1];
                                    ^^^^^^^^^^^
  test/custom/file_handles_test.dart:321:35: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handleTerm2 = rt.heap.writerValue[wHandle2];
                                    ^^^^^^^^^^^
  test/custom/file_handles_test.dart:337:36: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final contentsTerm = rt.heap.writerValue[wContents];
                                     ^^^^^^^^^^^
  test/custom/file_handles_test.dart:369:32: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handle1 = (rt.heap.writerValue[wHandle1] as ConstTerm).value as int;
                                 ^^^^^^^^^^^
  test/custom/file_handles_test.dart:383:32: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handle2 = (rt.heap.writerValue[wHandle2] as ConstTerm).value as int;
                                 ^^^^^^^^^^^
  test/custom/file_handles_test.dart:413:31: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final handle = (rt.heap.writerValue[wHandle] as ConstTerm).value as int;
                                ^^^^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/custom/file_handles_test.dart -p vm --plain-name 'loading test/custom/file_handles_test.dart'
00:01 [32m+60[0m[31m -17[0m: test/custom/struct_test.dart: Simple structure matching: p(f(a, b)) with bound reader[0m                                                                                                   

=== Testing Structure Matching with Reader ===
Program: p(f(a, b)).
Goal: p(X?) where X is already bound to f(a, b)

Heap Setup:
  Writer 1 (X) - bound to f(a, b)
  Reader 2 (X?) - paired with Writer 1

--- Executing Goal: p(X?) ---
Expected: Match X? (reads f(a, b)) with pattern f(a, b)

Goals executed: [100]
Expected: Goal executes successfully (structure matches pattern)

âœ“ Structure correctly matched in READ mode
âœ“ Test passed!
00:01 [32m+61[0m[31m -17[0m: test/custom/struct_test.dart: Simple structure matching: p(f(a, b)) with bound reader[0m                                                                                                   00:01 [32m+61[0m[31m -17[0m: test/custom/struct_test.dart: Structure matching: p(f(a, b)) fails on mismatch[0m                                                                                                          00:01 [32m+61[0m[31m -17[0m: test/custom/struct_test.dart: Structure matching: p(f(a, b)) fails on mismatch[0m                                                                                                          

=== Testing Structure Mismatch ===
Program: p(f(a, b)).
Goal: p(X?) where X is bound to f(a, c) - should FAIL

Heap Setup:
  Writer 1 (X) - bound to f(a, c)
  Reader 2 (X?) - paired with Writer 1

--- Executing Goal: p(X?) ---
Expected: FAIL or SUSPEND (no matching clause)

Goals executed: [100]
âœ“ Mismatch correctly detected
âœ“ Test passed!
00:01 [32m+62[0m[31m -17[0m: test/custom/struct_test.dart: Structure matching: p(f(a, b)) fails on mismatch[0m                                                                                                          00:01 [32m+62[0m[31m -17[0m: test/custom/merge_sequential_123_abcd_test.dart: Sequential merge: merge([1,2,3],[],Xs), merge(Xs?,[a,b,c,d],Ys) [1m[31m[E][0m[0m                                                                    
  Expected: [1, 'a', 2, 'b', 3, 'c', 'd']
    Actual: [1]
     Which: at location [1] is [1] which shorter than expected
  Ys should be [1, a, 2, b, 3, c, d]
  
  package:matcher                                        expect
  test/custom/merge_sequential_123_abcd_test.dart 240:7  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/merge_sequential_123_abcd_test.dart -p vm --plain-name 'Sequential merge: merge([1,2,3],[],Xs), merge(Xs?,[a,b,c,d],Ys)'
00:01 [32m+62[0m[31m -18[0m: [1m[90mloading test/custom/extended_predicates_test.dart[0m [1m[31m[E][0m[0m                                                                                                                                   
  [31mFailed to load "test/custom/extended_predicates_test.dart":[0m
  test/custom/extended_predicates_test.dart:148:33: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final listValue = rt.heap.writerValue[wList];
                                  ^^^^^^^^^^^
  test/custom/extended_predicates_test.dart:208:33: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final nameValue = rt.heap.writerValue[wName];
                                  ^^^^^^^^^^^
  test/custom/extended_predicates_test.dart:238:33: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final nameValue = rt.heap.writerValue[wName];
                                  ^^^^^^^^^^^
  test/custom/extended_predicates_test.dart:262:33: Error: The getter 'writerValue' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerValue'.
        final copyValue = rt.heap.writerValue[wCopy];
                                  ^^^^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/custom/extended_predicates_test.dart -p vm --plain-name 'loading test/custom/extended_predicates_test.dart'
00:01 [32m+62[0m[31m -18[0m: [1m[90mloading test/custom/simple_body_test.dart[0m[0m                                                                                                                                               00:01 [32m+62[0m[31m -18[0m: test/custom/simple_body_test.dart: Simple BODY test: forward(X) :- p(X)[0m                                                                                                                 00:01 [32m+62[0m[31m -18[0m: test/custom/simple_body_test.dart: Simple BODY test: forward(X) :- p(X)[0m                                                                                                                 

======================================================================
SIMPLE BODY TEST
Program: p(a). forward(X) :- p(X).
Goal: forward(Y) where Y is unbound writer
Expected: Y binds to a via p(Y)
======================================================================

HEAP SETUP:
  Writer 1 (Y) paired with Reader 2 (Y?)

PROGRAM LABELS:
  p/1 => PC 0
  p/1_end => PC 5
  forward/1 => PC 7
  forward/1_end => PC 13

Goal: forward(Y) at PC 7
CallEnv: writers={{0: 1}}

Goals executed: [100]
Total executions: 1

======================================================================
RESULTS
======================================================================
Y (W1) bound: true
Y value: Const(a)
âœ“ Y correctly bound to a
âœ“ BODY instructions working correctly!
00:01 [32m+63[0m[31m -18[0m: test/custom/p_fact_program_test.dart: p(X) â€” succeeds and binds X = a[0m                                                                                                                   00:01 [32m+64[0m[31m -18[0m: test/custom/custom_template_test.dart: custom: commit wakes exactly one suspended goal[0m                                                                                                  00:01 [32m+65[0m[31m -18[0m: test/custom/custom_template_test.dart: custom: commit wakes exactly one suspended goal[0m                                                                                                  00:01 [32m+66[0m[31m -18[0m: test/custom/custom_template_test.dart: custom: commit wakes exactly one suspended goal[0m                                                                                                  00:01 [32m+66[0m[31m -19[0m: [1m[90mloading test/custom/p_q_trace_test.dart[0m[0m                                                                                                                                                 00:01 [32m+66[0m[31m -19[0m: test/custom/p_q_trace_test.dart: P/Q program with detailed trace: p(a). p(b). q(b). Goal: q(X?), p(X)[0m                                                                                   00:01 [32m+66[0m[31m -19[0m: test/custom/p_q_trace_test.dart: P/Q program with detailed trace: p(a). p(b). q(b). Goal: q(X?), p(X)[0m                                                                                   

============================================================
PROGRAM:
  p(a).
  p(b).
  q(b).

GOAL: q(X?), p(X)
============================================================

HEAP INITIALIZATION:
  Writer 1 (X) - unbound
  Reader 2 (X?) - paired with Writer 1

PROGRAMS COMPILED:
  Program Q (q/1): 7 instructions
  Program P (p/1): 12 instructions

============================================================
EXECUTION TRACE
============================================================

--- GOAL 100: q(X?) ---
Setting up goal 100 with program Q
  Arg 0: Reader 2 (X? - unbound)

Executing goal 100 with program Q...
00:01 [32m+66[0m[31m -19[0m: test/custom/custom_template_test.dart: custom: commit wakes exactly one suspended goal [1m[31m[E][0m[0m                                                                                              
  Expected: [42]
    Actual: []
     Which: at location [0] is [] which shorter than expected
  
  package:matcher                             expect
  test/custom/custom_template_test.dart 37:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/custom_template_test.dart -p vm --plain-name 'custom: commit wakes exactly one suspended goal'
00:01 [32m+66[0m[31m -19[0m: test/custom/p_q_trace_test.dart: P/Q program with detailed trace: p(a). p(b). q(b). Goal: q(X?), p(X)[0m                                                                                   
  Status: RunResult.suspended
  X bound: false
  Suspended on R2: 1 goals

--- GOAL 200: p(X) ---
Setting up goal 200 with program P
  Arg 0: Writer 1 (X - unbound)

Executing goal 200 with program P...
  Status: RunResult.terminated
  X bound: true
  X value: Const(a)
  Goals activated: 1

--- REACTIVATION: Goal 100 at PC 0 ---
  Goal program: q
  Using runner: Q

Executing reactivated goal 100...
  Status: RunResult.suspended

============================================================
FINAL STATE
============================================================
  X (Writer 1) bound: true
  X value: Const(a)
  Queue length: 0

âœ“ Test passed: X correctly bound to 'a' via first clause of p
âœ“ Goal 100 correctly reactivated with program Q

00:01 [32m+67[0m[31m -19[0m: test/custom/p_q_trace_test.dart: P/Q program with detailed trace: p(a). p(b). q(b). Goal: q(X?), p(X)[0m                                                                                   00:01 [32m+67[0m[31m -20[0m: [1m[90mloading test/custom/boot_test.dart[0m [1m[31m[E][0m[0m                                                                                                                                                  
  [31mFailed to load "test/custom/boot_test.dart":[0m
  test/custom/boot_test.dart:89:17: Error: The method 'containsWriter' isn't defined for the type 'Heap'.
   - 'Heap' is from 'package:glp_runtime/runtime/heap.dart' ('lib/runtime/heap.dart').
  Try correcting the name to the name of an existing method, or defining a method named 'containsWriter'.
      if (rt.heap.containsWriter(1000)) {
                  ^^^^^^^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/custom/boot_test.dart -p vm --plain-name 'loading test/custom/boot_test.dart'
00:01 [32m+67[0m[31m -20[0m: [1m[90mloading test/custom/circular_trace_test.dart[0m[0m                                                                                                                                            00:01 [32m+67[0m[31m -20[0m: test/custom/circular_trace_test.dart: Circular trace: merge(Xs?,[1],Ys), merge(Ys?,[2],Xs)[0m                                                                                              00:01 [32m+67[0m[31m -21[0m: [1m[90mloading test/custom/put_structure_test.dart[0m [1m[31m[E][0m[0m                                                                                                                                         
  [31mFailed to load "test/custom/put_structure_test.dart":[0m
  test/custom/put_structure_test.dart:184:26: Error: 'WriterTerm' isn't a type.
          expect(arg1, isA<WriterTerm>(), reason: 'Second arg should be WriterTerm (unbound tail)');
                           ^^^^^^^^^^
  test/custom/put_structure_test.dart:185:21: Error: 'WriterTerm' isn't a type.
          if (arg1 is WriterTerm) {
                      ^^^^^^^^^^
  test/custom/put_structure_test.dart:186:42: Error: The getter 'writerId' isn't defined for the type 'Term'.
   - 'Term' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerId'.
            print('âœ“ WriterTerm ID: ${arg1.writerId}');
                                           ^^^^^^^^
  test/custom/put_structure_test.dart:188:50: Error: The getter 'writerId' isn't defined for the type 'Term'.
   - 'Term' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerId'.
            final tailWriter = rt.heap.writer(arg1.writerId);
                                                   ^^^^^^^^
  test/custom/put_structure_test.dart:190:45: Error: The getter 'writerId' isn't defined for the type 'Term'.
   - 'Term' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'writerId'.
            expect(rt.heap.isWriterBound(arg1.writerId), false,
                                              ^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/custom/put_structure_test.dart -p vm --plain-name 'loading test/custom/put_structure_test.dart'
00:01 [32m+67[0m[31m -21[0m: test/custom/circular_trace_test.dart: Circular trace: merge(Xs?,[1],Ys), merge(Ys?,[2],Xs)[0m                                                                                              

=== Tracing Circular Execution ===

Initial Heap:
  Writer 1 (Xs) - unbound, Reader 2
  Writer 3 (Ys) - unbound, Reader 4
  Writer 5 - bound to [1], Reader 6
  Writer 7 - bound to [2], Reader 8

=== Goal 4000: merge(Xs?, [1], Ys) ===
  Arg 0 (slot 0): Reader 2 (Xs? - unbound)
  Arg 1 (slot 1): Reader 6 ([1])
  Arg 2 (slot 2): Writer 3 (Ys - unbound)

=== Goal 5000: merge(Ys?, [2], Xs) ===
  Arg 0 (slot 0): Reader 4 (Ys? - unbound)
  Arg 1 (slot 1): Reader 8 ([2])
  Arg 2 (slot 2): Writer 1 (Xs - unbound)

=== Starting Scheduler ===

--- Cycle 1: Running Goal 4000 from PC 0 ---
Before execution:
  Xs (W1) bound: false, value: unbound
  Ys (W3) bound: false, value: unbound
00:01 [32m+67[0m[31m -21[0m: test/custom/metainterp_full_test.dart: Full metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                

======================================================================
FULL METAINTERPRETER TEST
Object program: clause(p(a),true). clause(p(b),true). clause(q(b),true).
Metainterpreter: run(true). run(A) :- otherwise | clause(A?,B), run(B?).
Query: boot :- run(p(X)), run(q(X?))
Expected: X binds to a (first solution), q(a) fails, backtrack not supported
======================================================================

HEAP SETUP:
  Writer 1 (X) paired with Reader 2 (X?)

PROGRAM LABELS:
  clause/2 => PC 0
  clause/2_c2 => PC 7
  clause/2_c3 => PC 14
  clause/2_end => PC 21
  run/1 => PC 23
  run/1_c2 => PC 28
  run/1_end => PC 38
  boot/0 => PC 40
  boot/0_end => PC 49

STRUCTURES:
  p(X) = reader 11 bound to p(W1)
  q(X?) = reader 13 bound to q(R2)

Starting: boot(p(X), q(X?)) at PC 40

00:01 [32m+67[0m[31m -21[0m: test/custom/circular_trace_test.dart: Circular trace: merge(Xs?,[1],Ys), merge(Ys?,[2],Xs)[0m                                                                                              
After execution:
  Result: RunResult.suspended
  Xs (W1) bound: false, value: unbound
  Ys (W3) bound: false, value: unbound
  ROQ R2: 1 suspended
  ROQ R4: 0 suspended

--- Cycle 2: Running Goal 5000 from PC 0 ---
Before execution:
  Xs (W1) bound: false, value: unbound
  Ys (W3) bound: false, value: unbound
After execution:
  Result: RunResult.suspended
  Xs (W1) bound: false, value: unbound
  Ys (W3) bound: false, value: unbound
  ROQ R2: 1 suspended
  ROQ R4: 1 suspended


=== Final State ===
Total cycles: 2
Xs bound: false
Ys bound: false
00:01 [32m+68[0m[31m -21[0m: test/custom/metainterp_full_test.dart: Full metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                00:01 [32m+68[0m[31m -22[0m: [1m[90mloading test/custom/metainterp_three_way_merge_test.dart[0m [1m[31m[E][0m[0m                                                                                                                            
  [31mFailed to load "test/custom/metainterp_three_way_merge_test.dart":[0m
  test/custom/metainterp_three_way_merge_test.dart:309:54: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
            final wid = rt.heap.writerIdForReader(head.readerId);
                                                       ^^^^^^^^
  test/custom/metainterp_three_way_merge_test.dart:314:35: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
              elements.add('R${head.readerId}(unbound)');
                                    ^^^^^^^^
  test/custom/metainterp_three_way_merge_test.dart:326:56: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
              final wid = rt.heap.writerIdForReader(tail.readerId);
                                                         ^^^^^^^^
  test/custom/metainterp_three_way_merge_test.dart:333:41: Error: The getter 'readerId' isn't defined for the type 'VarRef'.
   - 'VarRef' is from 'package:glp_runtime/runtime/terms.dart' ('lib/runtime/terms.dart').
  Try correcting the name to the name of an existing getter, or defining a getter or field named 'readerId'.
                elements.add('... R${tail.readerId}(unbound)');
                                          ^^^^^^^^

[1m[36mTo run this test again:[0m dart test test/custom/metainterp_three_way_merge_test.dart -p vm --plain-name 'loading test/custom/metainterp_three_way_merge_test.dart'
00:01 [32m+68[0m[31m -22[0m: test/custom/metainterp_full_test.dart: Full metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)[0m                                                                                

Goals executed: [100, 10000]
Total executions: 2

======================================================================
RESULTS
======================================================================
X (W1) bound: false
00:01 [32m+68[0m[31m -23[0m: [1m[90mloading test/custom/merge_circular_budget_test.dart[0m[0m                                                                                                                                     00:01 [32m+68[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             00:01 [32m+68[0m[31m -23[0m: test/custom/metainterp_full_test.dart: Full metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b) [1m[31m[E][0m[0m                                                                            
  Expected: <true>
    Actual: <false>
  X should be bound
  
  package:matcher                              expect
  test/custom/metainterp_full_test.dart 162:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/metainterp_full_test.dart -p vm --plain-name 'Full metainterpreter: run(p(X)), run(q(X?)) with p(a), p(b), q(b)'
00:01 [32m+68[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             

======================================================================
CIRCULAR MERGE WITH REDUCTION BUDGET
Goal 100: merge(Xs?, [1], Ys)
Goal 200: merge(Ys?, [a], Xs)
Reduction budget: 100 per goal execution
======================================================================

HEAP SETUP:
  List1 (W10/R10) = [1]
  ListA (W20/R20) = [a]
  Result Xs (W30/R30) = unbound
  Result Ys (W40/R40) = unbound

======================================================================
EXECUTION TRACE
======================================================================

--- GOAL 100: merge(Xs?, [1], Ys) ---
Executing with 100 reduction budget...
00:01 [32m+68[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate simple addition: 2 + 3 = 5[0m                                                                       

=== EVALUATE TEST: Simple Addition ===
Result: SystemResult.success
Expression: +(Const(2),Const(3))
âœ“ Evaluate succeeded for 2 + 3

00:01 [32m+69[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             00:01 [32m+69[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate expression with unbound reader - should suspend[0m                                                  

=== EVALUATE TEST: Unbound Reader Suspension ===
Result: SystemResult.suspend
Suspended readers: {2}
âœ“ Evaluate correctly suspended on unbound reader

00:01 [32m+70[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             00:01 [32m+70[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate with nested expression: (2 + 3) * 4 = 20[0m                                                         

=== EVALUATE TEST: Nested Expression ===
00:01 [32m+70[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             
Result: RunResult.suspended
Reductions used: 28
00:01 [32m+70[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate with nested expression: (2 + 3) * 4 = 20[0m                                                         
Result: SystemResult.success
00:01 [32m+70[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             
Xs bound: false
Ys bound: true
00:01 [32m+70[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate with nested expression: (2 + 3) * 4 = 20[0m                                                         
Expression: *(+(Const(2),Const(3)),Const(4))
âœ“ Evaluate succeeded for (2 + 3) * 4

00:01 [32m+70[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             
Ys value: .(Const(1),W1000)
00:01 [32m+71[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             00:01 [32m+71[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             
Suspended on readers: {}

--- GOAL 200: merge(Ys?, [a], Xs) ---
Executing with 100 reduction budget...
WARNING: PutReader got unexpected value: W1000
Result: RunResult.terminated
Reductions used: 26
Xs bound: true
Xs value: .(Const(1),W1002)
Ys bound: true
Ys value: .(Const(1),W1000)

--- CHECKING ACTIVATIONS ---
Goals in queue: 1
Queue contents: [100]

--- SUSPENSION/ACTIVATION TRACE ---

CYCLE 1:
  Dequeued: Goal 100 (PC 0)
  Queue before execution: 0 goals
WARNING: PutReader got unexpected value: W1002
  Execution result: RunResult.terminated
  Reductions used: 26
  Queue after execution: 0 goals


======================================================================
FINAL STATE AFTER 1 CYCLES
======================================================================
Xs bound: true
Xs value: .(Const(1),W1002)
Ys bound: true
Ys value: .(Const(1),W1000)
Goals remaining in queue: 0

âœ“ Circular merge with reduction budget test complete
00:01 [32m+71[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate division by zero - should fail[0m                                                                   

=== EVALUATE TEST: Division by Zero ===
Result: SystemResult.failure
âœ“ Evaluate correctly failed for division by zero

00:01 [32m+72[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             00:01 [32m+73[0m[31m -23[0m: test/custom/merge_circular_budget_test.dart: Circular merge with 100 reduction budget: merge(Xs?,[1],Ys), merge(Ys?,[a],Xs)[0m                                                             00:01 [32m+73[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate with all operators: +, -, *, /, mod[0m                                                              00:01 [32m+73[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate with all operators: +, -, *, /, mod[0m                                                              

=== EVALUATE TEST: All Operators ===
Expression: +(Const(10),Const(5)) => expected 15, result: SystemResult.success
Expression: -(Const(10),Const(5)) => expected 5, result: SystemResult.success
Expression: *(Const(10),Const(5)) => expected 50, result: SystemResult.success
Expression: /(Const(10),Const(5)) => expected 2, result: SystemResult.success
Expression: mod(Const(10),Const(3)) => expected 1, result: SystemResult.success
âœ“ All operators evaluated successfully

00:01 [32m+74[0m[31m -23[0m: test/custom/p_fact_writer_then_reader_test.dart: p(X), then p(X?) does not suspend and produces no activations[0m                                                                          00:01 [32m+74[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate with bound result variable - should verify[0m                                                       

=== EVALUATE TEST: Result Verification ===
Result: SystemResult.success
âœ“ Evaluate correctly verified bound result

00:01 [32m+75[0m[31m -23[0m: test/custom/p_fact_writer_then_reader_test.dart: p(X), then p(X?) does not suspend and produces no activations[0m                                                                          00:01 [32m+75[0m[31m -23[0m: test/custom/execute_evaluate_test.dart: Execute - evaluate/2 system predicate evaluate with mismatched bound result - should fail[0m                                                       

=== EVALUATE TEST: Result Mismatch ===
Result: SystemResult.failure
âœ“ Evaluate correctly failed for mismatched result

00:01 [32m+76[0m[31m -23[0m: test/custom/p_fact_writer_then_reader_test.dart: p(X), then p(X?) does not suspend and produces no activations[0m                                                                          00:01 [32m+76[0m[31m -24[0m: [1m[90mloading test/custom/hello_world_test.dart[0m[0m                                                                                                                                               00:01 [32m+76[0m[31m -24[0m: test/custom/hello_world_test.dart: hello_world/0: prints hello world[0m                                                                                                                    00:01 [32m+76[0m[31m -24[0m: test/custom/hello_world_test.dart: hello_world/0: prints hello world[0m                                                                                                                    

=== HELLO WORLD TEST ===

Running hello_world/0:
00:01 [32m+76[0m[31m -24[0m: test/custom/p_fact_writer_then_reader_test.dart: p(X), then p(X?) does not suspend and produces no activations [1m[31m[E][0m[0m                                                                      
  Expected: true
    Actual: <false>
  reader already bound â†’ no suspension
  
  package:matcher                                       expect
  test/custom/p_fact_writer_then_reader_test.dart 44:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/p_fact_writer_then_reader_test.dart -p vm --plain-name 'p(X), then p(X?) does not suspend and produces no activations'
00:01 [32m+76[0m[31m -24[0m: test/custom/hello_world_test.dart: hello_world/0: prints hello world[0m                                                                                                                    hello world
00:01 [32m+76[0m[31m -24[0m: test/custom/hello_world_test.dart: hello_world/0: prints hello world[0m                                                                                                                    

Result: RunResult.terminated
âœ“ hello_world/0 executed successfully

00:01 [32m+76[0m[31m -24[0m: test/custom/interactive_test.dart: Program: facts, Goal: p(X), p(X?)[0m                                                                                                                    

=== Program: facts ===
p(a).
p(b).

=== Goal: p(X), p(X?) ===

Heap Setup:
  Writer 1 (X) - unbound
  Reader 2 (X?) - paired with Writer 1

--- Executing Goal 1: p(X) ---
00:01 [32m+77[0m[31m -24[0m: test/custom/interactive_test.dart: Program: facts, Goal: p(X), p(X?)[0m                                                                                                                    00:01 [32m+77[0m[31m -24[0m: test/custom/interactive_test.dart: Program: facts, Goal: p(X), p(X?)[0m                                                                                                                    
Result: RunResult.terminated
Writer 1 bound? true
Writer 1 value: Const(a)

--- Executing Goal 2: p(X?) ---
Result: RunResult.suspended
Reader 2 bound? true
Reader 2 reads value: Const(a)

=== Final State ===
X = Const(a)
SUCCESS âœ“
00:01 [32m+77[0m[31m -24[0m: test/compiler/verify_merge_base_test.dart: Verify: merge([],[],[]).[0m                                                                                                                     

======================================================================
COMPILER VERIFICATION TEST
Source: merge([],[],[]).
Goal: merge([], [], []) - should succeed
======================================================================

00:01 [32m+77[0m[31m -25[0m: test/compiler/verify_merge_base_test.dart: Verify: merge([],[],[]).[0m                                                                                                                     
COMPILED BYTECODE:
  0: Instance of 'Label'
  1: Instance of 'ClauseTry'
  2: Instance of 'HeadNil'
  3: Instance of 'HeadNil'
  4: Instance of 'HeadNil'
  5: Instance of 'Commit'
  6: Instance of 'Proceed'
  7: Instance of 'Label'
  8: Instance of 'NoMoreClauses'

COMPILED LABELS:
  merge/3 => 0
  merge/3_end => 7

----------------------------------------------------------------------
BYTECODE VERIFICATION:
  merge/3 should have:
    - Label
    - ClauseTry
    - HeadNil(0) for first []
    - HeadNil(1) for second []
    - HeadNil(2) for third []
    - Commit
    - Proceed
    - Label(_end)
    - NoMoreClauses
----------------------------------------------------------------------

âœ“ Bytecode structure verified!

======================================================================
EXECUTION TEST
======================================================================

HEAP SETUP:
  Arg0 (Xs?) = []
  Arg1 (Ys?) = []
  Arg2 (Zs?) = []

Goal: merge([], [], []) at PC 0
CallEnv: readers={0: 2, 1: 4, 2: 6}

00:01 [32m+77[0m[31m -25[0m: test/custom/interactive_test.dart: Program: facts, Goal: p(X), p(X?) [1m[31m[E][0m[0m                                                                                                                
  Expected: RunResult:<RunResult.terminated>
    Actual: RunResult:<RunResult.suspended>
  
  package:matcher                         expect
  test/custom/interactive_test.dart 90:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/custom/interactive_test.dart -p vm --plain-name 'Program: facts, Goal: p(X), p(X?)'
00:01 [32m+77[0m[31m -25[0m: test/compiler/verify_merge_base_test.dart: Verify: merge([],[],[]).[0m                                                                                                                     
Goals executed: [100]
Total executions: 1

âœ“ Success! merge([],[],[]) completed
âœ“ Compiled program matches hand-written semantics!

00:01 [32m+78[0m[31m -25[0m: test/compiler/verify_merge_base_test.dart: Verify: merge([],[],[]).[0m                                                                                                                     00:01 [32m+78[0m[31m -25[0m: [1m[90mloading test/compiler/integration_simple_test.dart[0m[0m                                                                                                                                      00:01 [32m+78[0m[31m -25[0m: test/compiler/integration_simple_test.dart: Compiler Integration - Simple Programs compile and run: p(a).[0m                                                                               00:01 [32m+78[0m[31m -25[0m: test/compiler/integration_simple_test.dart: Compiler Integration - Simple Programs compile and run: p(a).[0m                                                                               

=== INTEGRATION TEST: p(a) ===
Compiled 7 instructions
Labels: {p/1: 0, p/1_end: 5}
Running goal p(a)...
00:01 [32m+78[0m[31m -25[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: p(X) :- q(X?). q(a).[0m                                                                

=== INTEGRATION TEST: p(X) :- q(X?). q(a). ===
Compiled 16 instructions
Labels: [p/1, p/1_end, q/1, q/1_end]
  0: Instance of 'Label'
  1: Instance of 'ClauseTry'
  2: Instance of 'GetVariable'
  3: Instance of 'Commit'
  4: put_reader(X0, A0)
  5: Instance of 'Spawn'
  6: Instance of 'Proceed'
  7: Instance of 'Label'
  8: Instance of 'NoMoreClauses'
  9: Instance of 'Label'
  10: Instance of 'ClauseTry'
  11: Instance of 'HeadConstant'
  12: Instance of 'Commit'
  13: Instance of 'Proceed'
  14: Instance of 'Label'
  15: Instance of 'NoMoreClauses'
Running p(W) - should spawn q(W?) which binds W to a...
00:01 [32m+78[0m[31m -25[0m: test/compiler/integration_simple_test.dart: Compiler Integration - Simple Programs compile and run: p(a).[0m                                                                               
Goals executed: 1
âœ“ Compiled and executed p(a) successfully

00:01 [32m+79[0m[31m -25[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: p(X) :- q(X?). q(a).[0m                                                                00:01 [32m+79[0m[31m -25[0m: test/compiler/integration_simple_test.dart: Compiler Integration - Simple Programs compile and run: p(X).[0m                                                                               

=== INTEGRATION TEST: p(X) ===
Compiled 7 instructions
Running goal p(W) with unbound writer...
Goals executed: 1
Writer bound: false
âœ“ Compiled and executed p(X) successfully

00:01 [32m+80[0m[31m -25[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: p(X) :- q(X?). q(a).[0m                                                                00:01 [32m+80[0m[31m -25[0m: test/compiler/integration_simple_test.dart: Compiler Integration - Simple Programs compile and run: p(a). p(b).[0m                                                                         

=== INTEGRATION TEST: p(a). p(b). ===
Compiled 12 instructions
Labels: [p/1, p/1_c1, p/1_end]
Running p(a)...
âœ“ p(a) succeeded
Running p(b)...
âœ“ p(b) succeeded
Running p(c)...
âœ“ p(c) failed as expected

00:01 [32m+81[0m[31m -25[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: p(X) :- q(X?). q(a).[0m                                                                00:01 [32m+81[0m[31m -25[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: p(X) :- q(X?). q(a).[0m                                                                
Goals executed: 2
Writer bound: false
00:01 [32m+81[0m[31m -26[0m: [1m[90mloading test/compiler/compare_bytecode_test.dart[0m[0m                                                                                                                                        00:01 [32m+81[0m[31m -26[0m: test/compiler/compare_bytecode_test.dart: Compare compiled vs hand-written bytecode[0m                                                                                                     00:01 [32m+81[0m[31m -26[0m: test/compiler/compare_bytecode_test.dart: Compare compiled vs hand-written bytecode[0m                                                                                                     

=== BYTECODE COMPARISON ===

00:01 [32m+81[0m[31m -26[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: p(X) :- q(X?). q(a). [1m[31m[E][0m[0m                                                            
  Expected: true
    Actual: <false>
  W should be bound to a
  
  package:matcher                                expect
  test/compiler/integration_body_test.dart 64:7  main.<fn>.<fn>
  

[1m[36mTo run this test again:[0m dart test test/compiler/integration_body_test.dart -p vm --plain-name 'Compiler Integration - Clauses with Body compile and run: p(X) :- q(X?). q(a).'
00:01 [32m+81[0m[31m -26[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: p(X, Y) :- q(X?), r(Y?). with spawn[0m                                                 

=== INTEGRATION TEST: p(X,Y) :- q(X?), r(Y?). ===
Compiled 26 instructions
Running p(W1, W2) - should spawn q(W1?) and requeue r(W2?)...
Goals executed: 3
W1 bound: false
W2 bound: false
00:01 [32m+81[0m[31m -27[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: p(X, Y) :- q(X?), r(Y?). with spawn [1m[31m[E][0m[0m                                             
  Expected: true
    Actual: <false>
  W1 should be bound to a
  
  package:matcher                                 expect
  test/compiler/integration_body_test.dart 113:7  main.<fn>.<fn>
  

[1m[36mTo run this test again:[0m dart test test/compiler/integration_body_test.dart -p vm --plain-name 'Compiler Integration - Clauses with Body compile and run: p(X, Y) :- q(X?), r(Y?). with spawn'
00:01 [32m+81[0m[31m -27[0m: test/compiler/compare_bytecode_test.dart: Compare compiled vs hand-written bytecode[0m                                                                                                     
COMPILED BYTECODE:
0: Instance of 'Label'
1: Instance of 'ClauseTry'
2: Instance of 'GetVariable'
3: Instance of 'Commit'
4: put_reader(X0, A0)
5: Instance of 'Spawn'
6: Instance of 'Proceed'
7: Instance of 'Label'
8: Instance of 'NoMoreClauses'
9: Instance of 'Label'
10: Instance of 'ClauseTry'
11: Instance of 'HeadConstant'
12: Instance of 'Commit'
13: Instance of 'Proceed'
14: Instance of 'Label'
15: Instance of 'NoMoreClauses'

LABELS:
  p/1 => 0
  p/1_end => 7
  q/1 => 9
  q/1_end => 14


EXPECTED HAND-WRITTEN EQUIVALENT:
0: Label(p/1)
1: ClauseTry()
2: GetVariable(0, 0)  // X from arg0
3: Commit()
4: PutReader(0, 0)    // arg0 = X?
5: Requeue(q/1, 1)    // tail call q(X?)
6: Label(p/1_end)
7: NoMoreClauses()
8: Label(q/1)
9: ClauseTry()
10: HeadConstant(a, 0)
11: Commit()
12: Proceed()
13: Label(q/1_end)
14: NoMoreClauses()
00:01 [32m+81[0m[31m -27[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: suspension on unbound reader[0m                                                        

=== INTEGRATION TEST: Suspension ===
Compiled 7 instructions
Running p(R?) with unbound reader - should suspend...
Goals executed: 1
ROQ has suspension: false
00:01 [32m+81[0m[31m -28[0m: test/compiler/integration_body_test.dart: Compiler Integration - Clauses with Body compile and run: suspension on unbound reader [1m[31m[E][0m[0m                                                    
  Expected: true
    Actual: <false>
  Should have suspension note
  
  package:matcher                                 expect
  test/compiler/integration_body_test.dart 157:7  main.<fn>.<fn>
  

[1m[36mTo run this test again:[0m dart test test/compiler/integration_body_test.dart -p vm --plain-name 'Compiler Integration - Clauses with Body compile and run: suspension on unbound reader'
00:01 [32m+81[0m[31m -29[0m: [1m[90mloading test/compiler/verify_body_reader_test.dart[0m[0m                                                                                                                                      00:01 [32m+81[0m[31m -29[0m: test/compiler/verify_body_reader_test.dart: Verify: p(X) :- q(X?). q(a).[0m                                                                                                                00:01 [32m+81[0m[31m -29[0m: test/compiler/verify_body_reader_test.dart: Verify: p(X) :- q(X?). q(a).[0m                                                                                                                

======================================================================
COMPILER VERIFICATION TEST
Source: p(X) :- q(X?). q(a).
Goal: p(W) where W is unbound writer
Expected: p spawns q(W?), q binds W to a
======================================================================

00:01 [32m+81[0m[31m -29[0m: test/compiler/compare_bytecode_test.dart: Compare compiled vs hand-written bytecode [1m[31m[E][0m[0m                                                                                                 
  Expected: <Instance of 'PutReader'>
    Actual: PutVariable:<put_reader(X0, A0)>
     Which: is not an instance of 'PutReader'
  
  package:matcher                                expect
  test/compiler/compare_bytecode_test.dart 49:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/compiler/compare_bytecode_test.dart -p vm --plain-name 'Compare compiled vs hand-written bytecode'
00:01 [32m+81[0m[31m -29[0m: test/compiler/verify_body_reader_test.dart: Verify: p(X) :- q(X?). q(a).[0m                                                                                                                
COMPILED BYTECODE:
  0: Instance of 'Label'
  1: Instance of 'ClauseTry'
  2: Instance of 'GetVariable'
  3: Instance of 'Commit'
  4: put_reader(X0, A0)
  5: Instance of 'Spawn'
  6: Instance of 'Proceed'
  7: Instance of 'Label'
  8: Instance of 'NoMoreClauses'
  9: Instance of 'Label'
  10: Instance of 'ClauseTry'
  11: Instance of 'HeadConstant'
  12: Instance of 'Commit'
  13: Instance of 'Proceed'
  14: Instance of 'Label'
  15: Instance of 'NoMoreClauses'

COMPILED LABELS:
  p/1 => 0
  p/1_end => 7
  q/1 => 9
  q/1_end => 14

----------------------------------------------------------------------
BYTECODE VERIFICATION:
  p/1 body should use PutReader and Requeue
  q/1 should match constant a
----------------------------------------------------------------------

00:01 [32m+81[0m[31m -30[0m: test/compiler/compare_run_struct_test.dart: Compare+Run: struct_test.dart - p(f(a,b))[0m                                                                                                   

=== STRUCT TEST: p(f(a,b)) ===

Compiled 9 instructions
00:01 [32m+81[0m[31m -30[0m: test/compiler/verify_body_reader_test.dart: Verify: p(X) :- q(X?). q(a). [1m[31m[E][0m[0m                                                                                                            
  Expected: <Instance of 'PutReader'>
    Actual: PutVariable:<put_reader(X0, A0)>
     Which: is not an instance of 'PutReader'
  
  package:matcher                                  expect
  test/compiler/verify_body_reader_test.dart 47:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/compiler/verify_body_reader_test.dart -p vm --plain-name 'Verify: p(X) :- q(X?). q(a).'
00:01 [32m+81[0m[31m -30[0m: test/compiler/compare_run_struct_test.dart: Compare+Run: struct_test.dart - p(f(a,b))[0m                                                                                                   
Goals executed: [100]
Writer bound? true
âœ… p(f(a,b)) works!

00:01 [32m+82[0m[31m -30[0m: test/compiler/compare_run_struct_test.dart: Compare+Run: struct_test.dart - p(f(a,b))[0m                                                                                                   00:01 [32m+82[0m[31m -30[0m: [1m[90mloading test/compiler/verify_simple_pq_test.dart[0m[0m                                                                                                                                        00:01 [32m+82[0m[31m -30[0m: test/compiler/verify_simple_pq_test.dart: Verify: p(a). q(a). Goal: q(X?), p(X)[0m                                                                                                         00:01 [32m+82[0m[31m -30[0m: test/compiler/verify_simple_pq_test.dart: Verify: p(a). q(a). Goal: q(X?), p(X)[0m                                                                                                         

======================================================================
COMPILER VERIFICATION TEST
Source: p(a). q(a).
Goal: Run q(X?) first (suspends), then p(X) (binds X=a, wakes q)
======================================================================

COMPILED BYTECODE:
  0: Instance of 'Label'
  1: Instance of 'ClauseTry'
  2: Instance of 'HeadConstant'
  3: Instance of 'Commit'
  4: Instance of 'Proceed'
  5: Instance of 'Label'
  6: Instance of 'NoMoreClauses'
  7: Instance of 'Label'
  8: Instance of 'ClauseTry'
  9: Instance of 'HeadConstant'
  10: Instance of 'Commit'
  11: Instance of 'Proceed'
  12: Instance of 'Label'
  13: Instance of 'NoMoreClauses'

COMPILED LABELS:
  p/1 => 0
  p/1_end => 5
  q/1 => 7
  q/1_end => 12

----------------------------------------------------------------------
BYTECODE VERIFICATION:
  Both p/1 and q/1 should have:
    - Label
    - ClauseTry
    - HeadConstant(a, 0)
    - Commit
    - Proceed
    - Label(_end)
    - NoMoreClauses
----------------------------------------------------------------------

âœ“ Bytecode structure verified!

======================================================================
EXECUTION TEST
======================================================================

HEAP SETUP:
  Writer 1 (X) paired with Reader 2 (X?)

Step 1: Run q(X?) with unbound reader
00:01 [32m+83[0m[31m -30[0m: test/compiler/verify_simple_pq_test.dart: Verify: p(a). q(a). Goal: q(X?), p(X)[0m                                                                                                         00:01 [32m+83[0m[31m -30[0m: test/compiler/verify_simple_pq_test.dart: Verify: p(a). q(a). Goal: q(X?), p(X)[0m                                                                                                         
  Goals executed: [100]
  X bound? false
  Suspended on R2? 1 goals

Step 2: Run p(X) with unbound writer
  Goals executed: [200, 100]
  X bound? true
  X value: Const(a)

âœ“ Success! X = a, both goals succeeded
âœ“ Compiled program matches hand-written semantics!

00:01 [32m+84[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer detects SRSW violation - multiple writer occurrences[0m                                                                                         00:01 [32m+85[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer detects SRSW violation - multiple writer occurrences[0m                                                                                         00:01 [32m+85[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer detects SRSW violation - multiple reader occurrences without ground[0m                                                                          00:01 [32m+86[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer detects SRSW violation - multiple reader occurrences without ground[0m                                                                          00:01 [32m+86[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer allows multiple reader occurrences with ground guard[0m                                                                                         00:01 [32m+87[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer allows multiple reader occurrences with ground guard[0m                                                                                         00:01 [32m+87[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer analyzes merge/3 example[0m                                                                                                                     00:01 [32m+88[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer analyzes merge/3 example[0m                                                                                                                     00:01 [32m+88[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer assigns register indices[0m                                                                                                                     00:01 [32m+89[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer assigns register indices[0m                                                                                                                     00:01 [32m+89[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer handles nested structures[0m                                                                                                                    00:01 [32m+90[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer handles nested structures[0m                                                                                                                    00:01 [32m+90[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer handles underscore (anonymous variable)[0m                                                                                                      00:01 [32m+91[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer handles underscore (anonymous variable)[0m                                                                                                      00:01 [32m+91[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer marks clauses with guards and body[0m                                                                                                           00:01 [32m+92[0m[31m -30[0m: test/compiler/analyzer_test.dart: Analyzer marks clauses with guards and body[0m                                                                                                           00:01 [32m+92[0m[31m -30[0m: [1m[90mloading test/compiler/lexer_parser_test.dart[0m[0m                                                                                                                                            00:01 [32m+92[0m[31m -30[0m: test/compiler/lexer_parser_test.dart: Lexer tokenizes simple atoms and punctuation[0m                                                                                                      00:01 [32m+93[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                          00:01 [32m+94[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                          00:01 [32m+95[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                          00:01 [32m+95[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                          

======================================================================
COMPILER VERIFICATION TEST
Hand-written: p(a). forward(X) :- p(X). [PutWriter - binds X]
SRSW-compliant: p(a). forward(X) :- p(X?). [PutReader - suspends]
Goal: forward(Y) where Y is unbound writer
NOTE: Different semantics - SRSW version will suspend!
======================================================================

00:01 [32m+96[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                          00:01 [32m+97[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                          00:01 [32m+98[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                          00:01 [32m+99[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                          00:01 [32m+100[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                         00:01 [32m+101[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                         00:01 [32m+101[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                         
COMPILED BYTECODE:
  0: Instance of 'Label'
  1: Instance of 'ClauseTry'
  2: Instance of 'HeadConstant'
  3: Instance of 'Commit'
  4: Instance of 'Proceed'
  5: Instance of 'Label'
  6: Instance of 'NoMoreClauses'
  7: Instance of 'Label'
  8: Instance of 'ClauseTry'
  9: Instance of 'GetVariable'
  10: Instance of 'Commit'
  11: put_reader(X0, A0)
  12: Instance of 'Spawn'
  13: Instance of 'Proceed'
  14: Instance of 'Label'
  15: Instance of 'NoMoreClauses'

COMPILED LABELS:
  p/1 => 0
  p/1_end => 5
  forward/1 => 7
  forward/1_end => 14

----------------------------------------------------------------------
BYTECODE COMPARISON:
  Hand-written: Uses PutWriter(0, 0) - forwards X as writer
  Compiled:     Uses PutReader(0, 0) - passes X? as reader

DIFFERENCE: Hand-written violates SRSW (X appears twice).
SRSW-compliant version uses X? in body, generating PutReader.
----------------------------------------------------------------------

00:01 [32m+102[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                         00:01 [32m+103[0m[31m -30[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?).[0m                                                                                                         00:01 [32m+103[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses clause with reader[0m                                                                                                                 00:01 [32m+104[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses clause with reader[0m                                                                                                                 00:01 [32m+104[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses list syntax[0m                                                                                                                        00:01 [32m+105[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses list syntax[0m                                                                                                                        00:01 [32m+105[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses empty list[0m                                                                                                                         00:01 [32m+106[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses empty list[0m                                                                                                                         00:01 [32m+106[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses multi-element list[0m                                                                                                                 00:01 [32m+107[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses multi-element list[0m                                                                                                                 00:01 [32m+107[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses clause with body[0m                                                                                                                   00:01 [32m+108[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses clause with body[0m                                                                                                                   00:01 [32m+108[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses clause with guards and body[0m                                                                                                        00:01 [32m+109[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses clause with guards and body[0m                                                                                                        00:01 [32m+109[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses multiple clauses for same procedure[0m                                                                                                00:01 [32m+110[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses multiple clauses for same procedure[0m                                                                                                00:01 [32m+110[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses multiple procedures[0m                                                                                                                00:01 [32m+111[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses multiple procedures[0m                                                                                                                00:01 [32m+111[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses structures[0m                                                                                                                         00:01 [32m+112[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses structures[0m                                                                                                                         00:01 [32m+112[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses underscore[0m                                                                                                                         00:01 [32m+113[0m[31m -31[0m: test/compiler/lexer_parser_test.dart: Parser parses underscore[0m                                                                                                                         00:01 [32m+113[0m[31m -31[0m: test/compiler/verify_simple_body_test.dart: Verify: p(a). forward(X) :- p(X?). [1m[31m[E][0m[0m                                                                                                     
  Expected: <Instance of 'PutReader'>
    Actual: PutVariable:<put_reader(X0, A0)>
     Which: is not an instance of 'PutReader'
  
  package:matcher                                  expect
  test/compiler/verify_simple_body_test.dart 63:5  main.<fn>
  

[1m[36mTo run this test again:[0m dart test test/compiler/verify_simple_body_test.dart -p vm --plain-name 'Verify: p(a). forward(X) :- p(X?).'
00:01 [32m+113[0m[31m -31[0m: [1m[90mloading test/conformance/union_across_clauses_test.dart[0m[0m                                                                                                                                00:01 [32m+113[0m[31m -31[0m: test/conformance/union_across_clauses_test.dart: Union across clauses uses one hanger; ANY-of wake activates once[0m                                                                      00:01 [32m+114[0m[31m -31[0m: test/compiler/compiler_test.dart: GlpCompiler compiles simple fact[0m                                                                                                                     00:01 [32m+115[0m[31m -31[0m: test/compiler/compiler_test.dart: GlpCompiler compiles simple fact[0m                                                                                                                     00:01 [32m+115[0m[31m -31[0m: test/compiler/compiler_test.dart: GlpCompiler compiles clause with variables[0m                                                                                                           00:01 [32m+115[0m[31m -32[0m: test/compiler/compiler_test.dart: GlpCompiler compiles clause with variables [1m[31m[E][0m[0m                                                                                                       
  Expected: true
    Actual: <false>
  
  package:matcher                        expect
  test/compiler/compiler_test.dart 41:7  main.<fn>.<fn>
  

[1m[36mTo run this test again:[0m dart test test/compiler/compiler_test.dart -p vm --plain-name 'GlpCompiler compiles clause with variables'
00:01 [32m+115[0m[31m -32[0m: test/compiler/compiler_test.dart: GlpCompiler compiles clause with guards[0m                                                                                                              00:01 [32m+116[0m[31m -32[0m: test/compiler/compiler_test.dart: GlpCompiler compiles clause with guards[0m                                                                                                              00:01 [32m+116[0m[31m -32[0m: test/compiler/compiler_test.dart: GlpCompiler compiles list matching[0m                                                                                                                   00:01 [32m+116[0m[31m -33[0m: test/compiler/compiler_test.dart: GlpCompiler compiles list matching [1m[31m[E][0m[0m                                                                                                               
  Expected: true
    Actual: <false>
  
  package:matcher                        expect
  test/compiler/compiler_test.dart 68:7  main.<fn>.<fn>
  

[1m[36mTo run this test again:[0m dart test test/compiler/compiler_test.dart -p vm --plain-name 'GlpCompiler compiles list matching'
00:01 [32m+116[0m[31m -33[0m: test/compiler/compiler_test.dart: GlpCompiler compiles empty list[0m                                                                                                                      00:01 [32m+117[0m[31m -33[0m: test/compiler/compiler_test.dart: GlpCompiler compiles empty list[0m                                                                                                                      00:01 [32m+117[0m[31m -33[0m: test/compiler/compiler_test.dart: GlpCompiler compiles multiple clauses[0m                                                                                                                00:01 [32m+118[0m[31m -33[0m: test/conformance/commit_activation_test.dart: commit applies ÏƒÌ‚w effect: wake FIFO and single-reactivation[0m                                                                             00:01 [32m+119[0m[31m -33[0m: test/conformance/commit_activation_test.dart: commit applies ÏƒÌ‚w effect: wake FIFO and single-reactivation[0m                                                                             00:01 [32m+120[0m[31m -33[0m: test/conformance/commit_activation_test.dart: commit applies ÏƒÌ‚w effect: wake FIFO and single-reactivation[0m                                                                             00:01 [32m+121[0m[31m -33[0m: test/conformance/commit_activation_test.dart: commit applies ÏƒÌ‚w effect: wake FIFO and single-reactivation[0m                                                                             00:01 [32m+122[0m[31m -33[0m: test/conformance/commit_activation_test.dart: commit applies ÏƒÌ‚w effect: wake FIFO and single-reactivation[0m                                                                             00:01 [32m+123[0m[31m -33[0m: test/conformance/commit_activation_test.dart: commit applies ÏƒÌ‚w effect: wake FIFO and single-reactivation[0m                                                                             00:01 [32m+124[0m[31m -33[0m: test/conformance/commit_activation_test.dart: commit applies ÏƒÌ‚w effect: wake FIFO and single-reactivation[0m                                                                             00:01 [32m+125[0m[31m -33[0m: test/compiler/compiler_test.dart: GlpCompiler handles underscore correctly[0m                                                                                                             00:01 [32m+126[0m[31m -33[0m: test/compiler/compiler_test.dart: GlpCompiler handles underscore correctly[0m                                                                                                             00:01 [32m+126[0m[31m -33[0m: [1m[90mloading test/conformance/guard_purity_test.dart[0m[0m                                                                                                                                        00:01 [32m+126[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards are pure: HEAD/GUARD phase does not mutate heap[0m                                                                                        00:01 [32m+126[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards are pure: HEAD/GUARD phase does not mutate heap[0m                                                                                        

=== GUARD PURITY TEST: No Heap Mutation in Phase 1 ===
Before execution: writer 1 bound = false
00:01 [32m+127[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards are pure: HEAD/GUARD phase does not mutate heap[0m                                                                                        00:01 [32m+127[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards are pure: HEAD/GUARD phase does not mutate heap[0m                                                                                        
After execution: writer 1 bound = false
Goals executed: 1
âœ“ HEAD/GUARD phase did not mutate heap (ÏƒÌ‚w discarded on clause failure)

00:01 [32m+128[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards are pure: HEAD/GUARD phase does not mutate heap[0m                                                                                        00:01 [32m+128[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards cannot call allocate/deallocate: environment operations forbidden in Phase 1[0m                                                           00:01 [32m+128[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards cannot call allocate/deallocate: environment operations forbidden in Phase 1[0m                                                           

=== GUARD PURITY TEST: No Allocate/Deallocate in Guards ===
Testing legal program: allocate/deallocate in BODY phase only
âœ“ Allocate/Deallocate are only allowed in BODY phase (after COMMIT)

00:01 [32m+129[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards cannot call allocate/deallocate: environment operations forbidden in Phase 1[0m                                                           00:01 [32m+129[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards add to suspension set Si but do not mutate heap cells[0m                                                                                  00:01 [32m+129[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards add to suspension set Si but do not mutate heap cells[0m                                                                                  

=== GUARD PURITY TEST: Guards add to Si without heap mutation ===
Before execution: writer 1 bound = false
After execution: writer 1 bound = false
Goals executed: 1
âœ“ Guards add to suspension set Si without mutating heap cells

00:01 [32m+130[0m[31m -33[0m: test/conformance/guard_purity_test.dart: Guards add to suspension set Si but do not mutate heap cells[0m                                                                                  00:01 [32m+130[0m[31m -33[0m: [1m[90mloading test/conformance/commit_before_body_test.dart[0m[0m                                                                                                                                  00:01 [32m+130[0m[31m -33[0m: test/conformance/commit_before_body_test.dart: Commit occurs before body: ÏƒÌ‚w applied atomically before first body instruction[0m                                                         00:01 [32m+130[0m[31m -33[0m: test/conformance/commit_before_body_test.dart: Commit occurs before body: ÏƒÌ‚w applied atomically before first body instruction[0m                                                         

=== COMMIT BEFORE BODY TEST ===
Starting p(X) - testing commit timing
Before execution: writer 1 bound = false
00:01 [32m+131[0m[31m -33[0m: test/conformance/commit_before_body_test.dart: Commit occurs before body: ÏƒÌ‚w applied atomically before first body instruction[0m                                                         00:01 [32m+132[0m[31m -33[0m: test/conformance/commit_before_body_test.dart: Commit occurs before body: ÏƒÌ‚w applied atomically before first body instruction[0m                                                         00:01 [32m+132[0m[31m -33[0m: test/conformance/commit_before_body_test.dart: Commit occurs before body: ÏƒÌ‚w applied atomically before first body instruction[0m                                                         
After execution: writer 1 bound = true
Writer value: Const(a)
âœ“ COMMIT applied ÏƒÌ‚w to heap before entering BODY phase

00:01 [32m+133[0m[31m -33[0m: test/conformance/abandon_immediate_fail_test.dart: Abandon(X!) immediately wakes readers FIFO; writer marked abandoned[0m                                                                 00:01 [32m+133[0m[31m -33[0m: test/conformance/commit_before_body_test.dart: Commit binds paired reader and activates suspended goals[0m                                                                                

=== COMMIT ACTIVATES SUSPENDED GOALS TEST ===
Calling q(X?) where X is unbound...
Goal q suspended: true (ROQ for reader 2 has notes)
âœ“ q suspended on unbound reader X?
Calling p(X) to bind writer X...
Writer X bound: true
Goals executed: 2
âœ“ COMMIT bound writer, then paired reader, then activated suspended goal q

00:01 [32m+134[0m[31m -33[0m: test/conformance/abandon_immediate_fail_test.dart: Abandon(X!) immediately wakes readers FIFO; writer marked abandoned[0m                                                                 00:01 [32m+135[0m[31m -33[0m: test/conformance/abandon_immediate_fail_test.dart: Abandon(X!) immediately wakes readers FIFO; writer marked abandoned[0m                                                                 00:01 [32m+135[0m[31m -33[0m: [1m[90mloading test/conformance/restart_clause1_test.dart[0m[0m                                                                                                                                     00:01 [32m+135[0m[31m -33[0m: test/conformance/restart_clause1_test.dart: On wake, activation pc equals kappa (restart at clause 1)[0m                                                                                  00:01 [32m+136[0m[31m -33[0m: test/conformance/restart_clause1_test.dart: On wake, activation pc equals kappa (restart at clause 1)[0m                                                                                  00:01 [32m+136[0m[31m -33[0m: [31mSome tests failed.[0m                                                                                                                                                                     

Consider enabling the flag chain-stack-traces to receive more detailed exceptions.
For example, 'dart test --chain-stack-traces'.
