% Topic: Dynamic merge
% Section: Streams - Dynamic Merge
%
% Test goals:
% dynamic_merge([add([1,2]), add([a,b])], [], Out).

merge([X|Xs], Ys, [X?|Zs?]) :- merge(Ys?, Xs?, Zs).
merge(Xs, [Y|Ys], [Y?|Zs?]) :- merge(Xs?, Ys?, Zs).
merge([], Ys, Ys?).
merge(Xs, [], Xs?).

% Control stream carries add(Stream) messages
dynamic_merge([], Out, Out?).
dynamic_merge([add(S)|Ctrl], In, Out?) :-
    dynamic_merge(Ctrl?, Merged?, Out),
    merge(S?, In?, Merged).
